<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    <title>Hive高级操作 | YoungLiang | 生活充满乐趣与童真</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="">
    <meta name="description" content="Hive高级操作1.使用LIKE、AS创建表,表重命名，添加、修改、删除列 表结构数据复制根据已存在的表结构，使用like关键字，复制一个表结构一模一样的新表  Copy Code123456789101112hive&amp;gt; create table student_info2 like student_info;OKTime taken: 0.73 secondshive&amp;gt; show t">
<meta name="keywords" content="程序猿、跳舞爱好者、读书">
<meta property="og:type" content="article">
<meta property="og:title" content="Hive高级操作">
<meta property="og:url" content="https://yongliangzhang.github.io/blogs/2018/02/01/Hive高级查询操作/index.html">
<meta property="og:site_name" content="YoungLiang">
<meta property="og:description" content="Hive高级操作1.使用LIKE、AS创建表,表重命名，添加、修改、删除列 表结构数据复制根据已存在的表结构，使用like关键字，复制一个表结构一模一样的新表  Copy Code123456789101112hive&amp;gt; create table student_info2 like student_info;OKTime taken: 0.73 secondshive&amp;gt; show t">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-02-01T05:51:13.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hive高级操作">
<meta name="twitter:description" content="Hive高级操作1.使用LIKE、AS创建表,表重命名，添加、修改、删除列 表结构数据复制根据已存在的表结构，使用like关键字，复制一个表结构一模一样的新表  Copy Code123456789101112hive&amp;gt; create table student_info2 like student_info;OKTime taken: 0.73 secondshive&amp;gt; show t">
    
        <link rel="alternate" type="application/atom+xml" title="YoungLiang" href="/blogs/atom.xml">
    
    <link rel="shortcut icon" href="/blogs/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/blogs/img/brand.jpg)">
      <div class="brand">
        <a href="/blogs/" class="avatar waves-effect waves-circle waves-light">
          <img src="https://s1.ax2x.com/2018/01/31/ZL8UG.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">YoungLiang</h5>
          <a href="mailto:zhangyongliang1231@163.com" title="zhangyongliang1231@163.com" class="mail">zhangyongliang1231@163.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/blogs/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/blogs/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                历程
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/blogs/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/blogs/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/yongliangZhang" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://www.jianshu.com/u/31c3a36c409d" target="_blank" >
                <i class="icon icon-lg icon-book"></i>
                简书
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Hive高级操作</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Hive高级操作</h1>
        <h5 class="subtitle">
            
                <time datetime="2018-02-01T05:51:58.981Z" itemprop="datePublished" class="page-time">
  2018-02-01
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Hive高级操作"><span class="post-toc-number">1.</span> <span class="post-toc-text">Hive高级操作</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#1-使用LIKE、AS创建表-表重命名，添加、修改、删除列"><span class="post-toc-number">1.0.0.0.1.</span> <span class="post-toc-text">1.使用LIKE、AS创建表,表重命名，添加、修改、删除列</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-分桶表使用"><span class="post-toc-number">1.0.0.1.</span> <span class="post-toc-text">2.分桶表使用</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-导出数据"><span class="post-toc-number">1.0.0.2.</span> <span class="post-toc-text">3.导出数据</span></a></li></ol></li></ol></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-Hive高级查询操作"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Hive高级操作</h1>
        <div class="post-meta">
            <time class="post-time" title="2018-02-01 13:51:58" datetime="2018-02-01T05:51:58.981Z"  itemprop="datePublished">2018-02-01</time>

            


            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="Hive高级操作"><a href="#Hive高级操作" class="headerlink" title="Hive高级操作"></a>Hive高级操作</h1><h5 id="1-使用LIKE、AS创建表-表重命名，添加、修改、删除列"><a href="#1-使用LIKE、AS创建表-表重命名，添加、修改、删除列" class="headerlink" title="1.使用LIKE、AS创建表,表重命名，添加、修改、删除列"></a>1.使用LIKE、AS创建表,表重命名，添加、修改、删除列</h5><ul>
<li>表结构数据复制<br><br>根据已存在的表结构，使用like关键字，复制一个表结构一模一样的新表</li>
</ul>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">hive&gt; create table student_info2 like student_info;</span><br><span class="line">OK</span><br><span class="line">Time taken: 0.73 seconds</span><br><span class="line">hive&gt; show tables;</span><br><span class="line">OK</span><br><span class="line">employee</span><br><span class="line">student_info</span><br><span class="line">student_info2</span><br><span class="line">student_school_info</span><br><span class="line">student_school_info_external_partition</span><br><span class="line">student_school_info_partition</span><br><span class="line">Time taken: 0.15 seconds, Fetched: 6 row(s)</span><br></pre></td></tr></table></figure><p></p>
<p>根据已经存在的表，使用as关键字，创建一个与查询结果字段一致的表，同时将查询结果数据插入到新表</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table student_info3 as select * from student_info;</span><br></pre></td></tr></table></figure><p></p>
<p>只有student_id,name两个字段的表</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table student_info4 as select student_id,name from student_info;</span><br></pre></td></tr></table></figure><p></p>
<ul>
<li>表重命名<br><br>student_info4表重命名为student_id_name</li>
</ul>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table student_info4 rename to student_id_name;</span><br></pre></td></tr></table></figure><p></p>
<ul>
<li>添加列<br><br>给student_info3表添加性别列,新添加的字段会在所有列最后，分区列之前，在添加新列之前已经存在的数据文件中。<br><br>如果没有新添加列对应的数据，在查询的时候显示为空。添加多个列用逗号隔开。</li>
</ul>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hive&gt; alter table student_info3 add columns(gender string comment &apos;性别&apos;);</span><br><span class="line">OK</span><br><span class="line">Time taken: 0.185 seconds</span><br></pre></td></tr></table></figure><p></p>
<ul>
<li>删除列或修改列<br><br>修改列，将继续存在的列再定义一遍，需要替换的列重新定义</li>
</ul>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hive&gt; alter table student_info3 replace columns(student_id string,name string,age int,origin string,gender2 int);</span><br><span class="line">OK</span><br><span class="line">Time taken: 0.422 seconds</span><br></pre></td></tr></table></figure><p></p>
<p>删除列,将继续存在的列再定义一遍，需要删除的列不再定义</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hive&gt; alter table student_info3 replace columns(student_id string,name string,age int,origin string);</span><br><span class="line">OK</span><br><span class="line">Time taken: 0.529 seconds</span><br></pre></td></tr></table></figure><p></p>
<h4 id="2-分桶表使用"><a href="#2-分桶表使用" class="headerlink" title="2.分桶表使用"></a>2.分桶表使用</h4><ul>
<li>创建分桶表<br><br>按照指定字段取它的hash散列值分桶,创建学生入学信息分桶表</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">字段名称</th>
<th style="text-align:center">类型</th>
<th style="text-align:center">注释</th>
<th style="text-align:center">分桶字段</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">student_id</td>
<td style="text-align:center">string</td>
<td style="text-align:center">学生ID</td>
<td style="text-align:center">是</td>
</tr>
<tr>
<td style="text-align:center">name</td>
<td style="text-align:center">string</td>
<td style="text-align:center">姓名</td>
<td style="text-align:center">否</td>
</tr>
<tr>
<td style="text-align:center">age</td>
<td style="text-align:center">int</td>
<td style="text-align:center">年龄</td>
<td style="text-align:center">否</td>
</tr>
<tr>
<td style="text-align:center">origin</td>
<td style="text-align:center">string</td>
<td style="text-align:center">学院ID</td>
<td style="text-align:center">否</td>
</tr>
</tbody>
</table>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">create table rel.student_info_bucket(</span><br><span class="line">student_id string,</span><br><span class="line">name string,</span><br><span class="line">age int,</span><br><span class="line">origin string</span><br><span class="line">)</span><br><span class="line">clustered by (student_id) sorted by (student_id asc) into 4 buckets </span><br><span class="line">row format delimited </span><br><span class="line">fields terminated by &apos;\t&apos; </span><br><span class="line">lines terminated by &apos;\n&apos; </span><br><span class="line">stored as textfile;</span><br></pre></td></tr></table></figure><p></p>
<ul>
<li>分桶表插入数据<br><br>向student_info_bucket分桶表插入数据</li>
</ul>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">set hive.enforce.bucketing = true;</span><br><span class="line">set mapreduce.job.reduces=4;</span><br><span class="line">insert overwrite table student_info_bucket </span><br><span class="line">select student_id,name,age,origin </span><br><span class="line">from student_info </span><br><span class="line">cluster by(student_id);</span><br></pre></td></tr></table></figure><p></p>
<p>查看hdfs分桶文件</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop01 ~]# hadoop fs -ls /user/hive/warehouse/rel.db/student_info_bucket</span><br><span class="line">Found 4 items</span><br><span class="line">-rwxr-xr-x   3 hadoop supergroup         78 2018-01-24 19:33 /user/hive/warehouse/rel.db/student_info_bucket/000000_0</span><br><span class="line">-rwxr-xr-x   3 hadoop supergroup         84 2018-01-24 19:33 /user/hive/warehouse/rel.db/student_info_bucket/000001_0</span><br><span class="line">-rwxr-xr-x   3 hadoop supergroup         80 2018-01-24 19:33 /user/hive/warehouse/rel.db/student_info_bucket/000002_0</span><br><span class="line">-rwxr-xr-x   3 hadoop supergroup         81 2018-01-24 19:33 /user/hive/warehouse/rel.db/student_info_bucket/000003_0</span><br></pre></td></tr></table></figure><p></p>
<p><strong>说明：</strong></p>
<p>分桶表一般不使用load向分桶表中导入数据，因为load导入数据只是将数据复制到表的数据存储目录下，hive并不会在load的时候对数据进行分析然后按照分桶字段分桶，load只会将一个文件全部导入到分桶表中，并没有分桶。一般采用insert从其他表向分桶表插入数据。<br>分桶表在创建表的时候只是定义表的模型，插入的时候需要做如下操作：<br>在每次执行分桶插入的时候在当前执行的session会话中要设置</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive.enforce.bucketing=true;</span><br></pre></td></tr></table></figure><p></p>
<p>声明本次执行的是一次分桶操作。需要指定reduce个数与分桶的数量相同</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set mapreduce.job.reduces=4，</span><br></pre></td></tr></table></figure><p></p>
<p>这样才能保证有多少桶就生成多少个文件。<br>如果定义了按照分桶字段排序，需要在从其他表查询数据过程中将数据按照分区字段排序之后插入各个桶中，分桶表并不会将各分桶中的数据排序。排序和分桶的字段相同的时候使用Cluster by(字段),cluster by 默认按照分桶字段在桶内升序排列，如果需要在桶内降序排列，使用distribute by (col) sort by (col desc)组合实现。</p>
<h4 id="3-导出数据"><a href="#3-导出数据" class="headerlink" title="3.导出数据"></a>3.导出数据</h4><ul>
<li>使用insert将student_info表数据导出到本地指定路径<br></li>
</ul>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">insert overwrite local directory &apos;/home/hadoop/apps/hive_test_data/export_data&apos; </span><br><span class="line">row format delimited  fields terminated by &apos;\t&apos; select * from student_info;</span><br></pre></td></tr></table></figure><p></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop01 export_data]# cat 000000_0 </span><br><span class="line">1	xiaoming	20	11</span><br><span class="line">2	xiaobai	21	31</span><br><span class="line">3	zhangfei	22	44</span><br><span class="line">4	likui	19	44</span><br><span class="line">5	zhaoyun	21	13</span><br><span class="line">6	zhangsan	20	11</span><br><span class="line">7	lisi	19	11</span><br><span class="line">8	wangwu	23	31</span><br><span class="line">9	zhaofei	19	21</span><br><span class="line">10	zhangyan	20	21</span><br><span class="line">11	lihe	20	22</span><br><span class="line">12	caoyang	17	32</span><br><span class="line">13	lihao	19	32</span><br><span class="line">14	zhaoming	21	50</span><br><span class="line">15	zhouhong	18	51</span><br><span class="line">16	yangshuo	23	33</span><br><span class="line">17	xiaofei	24	13</span><br><span class="line">18	liman	23	13</span><br><span class="line">19	qianbao	20	13</span><br><span class="line">20	sunce	21	41</span><br><span class="line">&lt;p class=&quot;code-caption&quot; data-lang=&quot;&quot; data-line_number=&quot;frontend&quot; data-trim_indent=&quot;backend&quot; data-label_position=&quot;outer&quot; data-labels_left=&quot;Code&quot; data-labels_right=&quot;:&quot; data-labels_copy=&quot;Copy Code&quot;&gt;&lt;span class=&quot;code-caption-label&quot;&gt;&lt;/span&gt;&lt;a class=&quot;code-caption-copy&quot;&gt;Copy Code&lt;/a&gt;&lt;/p&gt;</span><br><span class="line">```  </span><br><span class="line">导出数据到本地的常用方法</span><br></pre></td></tr></table></figure>
<p>[hadoop@hadoop01 export_data]$ hive -e”select * from rel.student_info”&gt; /home/hadoop/student_info_data.txt</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p>
<p>[hadoop@hadoop01 ~]$ cat student_info_data.txt<br>1    xiaoming    20    11<br>2    xiaobai    21    31<br>3    zhangfei    22    44<br>4    likui    19    44<br>5    zhaoyun    21    13<br>6    zhangsan    20    11<br>7    lisi    19    11<br>8    wangwu    23    31<br>9    zhaofei    19    21<br>10    zhangyan    20    21<br>11    lihe    20    22<br>12    caoyang    17    32<br>13    lihao    19    32<br>14    zhaoming    21    50<br>15    zhouhong    18    51<br>16    yangshuo    23    33<br>17    xiaofei    24    13<br>18    liman    23    13<br>19    qianbao    20    13<br>20    sunce    21    41</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">默认结果分隔符：&apos;\t&apos;</span><br><span class="line">#### 4.关联查询</span><br><span class="line"> 创建2张表</span><br></pre></td></tr></table></figure><p></p>
<p>create table rel.a(<br>id int,<br>name string<br>)<br>row format delimited<br>fields terminated by ‘\t’<br>lines terminated by ‘\n’<br>stored as textfile;</p>
<p>create table rel.b(<br>id int,<br>name string<br>)<br>row format delimited<br>fields terminated by ‘\t’<br>lines terminated by ‘\n’<br>stored as textfile;</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">导入数据</span><br></pre></td></tr></table></figure><p></p>
<p>hive&gt; load data local inpath ‘/home/hadoop/apps/hive_test_data/a_join_data’ into table a;<br>Loading data to table rel.a<br>Table rel.a stats: [numFiles=1, totalSize=61]<br>OK<br>Time taken: 1.79 seconds<br>hive&gt; load data local inpath ‘/home/hadoop/apps/hive_test_data/b_join_data’ into table b;<br>Loading data to table rel.b<br>Table rel.b stats: [numFiles=1, totalSize=38]<br>OK<br>Time taken: 0.562 seconds</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- inner或inner join</span><br><span class="line">&lt;br&gt;</span><br><span class="line">两个表通过id关联，只把id值相等的数据查询出来。join的查询结果与inner join的查询结果相同。</span><br></pre></td></tr></table></figure><p></p>
<p>select * from a join b on a.id=b.id;</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">等同于</span><br></pre></td></tr></table></figure><p></p>
<p>select * from a inner join b on a.id=b.id;<br>…..<br>OK<br>1    a    1    AA<br>2    b    2    BB<br>3    c    3    CC<br>6    f    6    FF<br>Time taken: 44.337 seconds, Fetched: 4 row(s)</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- full outer join或full join</span><br><span class="line"></span><br><span class="line">两个表通过id关联，把两个表的数据全部查询出来</span><br></pre></td></tr></table></figure><p></p>
<p>OK<br>1    a    1    AA<br>2    b    2    BB<br>3    c    3    CC<br>4    d    NULL    NULL<br>5    e    NULL    NULL<br>6    f    6    FF<br>7    g    NULL    NULL<br>8    h    NULL    NULL<br>9    i    NULL    NULL<br>10    j    NULL    NULL<br>11    k    NULL    NULL<br>12    l    NULL    NULL<br>13    m    NULL    NULL<br>14    n    NULL    NULL<br>NULL    NULL    20    TT<br>NULL    NULL    21    UU<br>NULL    NULL    22    vv</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- left join</span><br><span class="line"></span><br><span class="line">左连接时，左表中出现的join字段都保留，右表没有连接上的都为空</span><br></pre></td></tr></table></figure><p></p>
<p>OK<br>1    a    1    AA<br>2    b    2    BB<br>3    c    3    CC<br>4    d    NULL    NULL<br>5    e    NULL    NULL<br>6    f    6    FF<br>7    g    NULL    NULL<br>8    h    NULL    NULL<br>9    i    NULL    NULL<br>10    j    NULL    NULL<br>11    k    NULL    NULL<br>12    l    NULL    NULL<br>13    m    NULL    NULL<br>14    n    NULL    NULL</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- right join</span><br><span class="line"></span><br><span class="line">右连接时，右表中出现的join字段都保留，左表没有连接上的都是空</span><br></pre></td></tr></table></figure><p></p>
<p>select * from a right join b on a.id=b.id;</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p>
<p>OK<br>1    a    1    AA<br>2    b    2    BB<br>3    c    3    CC<br>6    f    6    FF<br>NULL    NULL    20    TT<br>NULL    NULL    21    UU<br>NULL    NULL    22    vv<br>Time taken: 25.188 seconds, Fetched: 7 row(s)</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- left semi join</span><br><span class="line"></span><br><span class="line">左半连接实现了类似IN/EXISTS的查询语义，输出符合条件的左表内容。</span><br><span class="line">hive不支持in …exists这种关系型数据库中的子查询结构，hive暂时不支持右半连接。</span><br><span class="line">例如：</span><br></pre></td></tr></table></figure><p></p>
<p>select a.id, a.name from a where a.id in (select b.id from b);</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">使用Hive对应于如下语句：</span><br></pre></td></tr></table></figure><p></p>
<p>select a.id,a.name from a left semi join b on a.id = b.id;</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p>
<p>OK<br>1    a<br>2    b<br>3    c<br>6    f<br>Time taken: 27.42 seconds, Fetched: 4 row(s)</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- map side join</span><br><span class="line"></span><br><span class="line">使用分布式缓存将小表数据加载都各个map任务中，在map端完成join，map任务输出后，不需要将数据拷贝到reducer阶段再进行join，</span><br><span class="line">降低的数据在网络节点之间传输的开销。多表关联数据倾斜优化的一种手段。多表连接，如果只有一个表比较大，其他表都很小，</span><br><span class="line">则join操作会转换成一个只包含map的Job。运行日志中会出现Number of reduce tasks is set to 0 since there&apos;s no reduce operator</span><br><span class="line">没有reduce的提示。</span><br><span class="line">例如：</span><br></pre></td></tr></table></figure><p></p>
<p>select /<em>+ mapjoin(b) </em>/ a.id, a.name from a join b on a.id = b.id</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p>
<p>Total MapReduce CPU Time Spent: 1 seconds 320 msec<br>OK<br>1    a<br>2    b<br>3    c<br>6    f<br>Time taken: 25.538 seconds, Fetched: 4 row(s)</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#### 5.Hive内置函数</span><br><span class="line">创建用户评分表</span><br></pre></td></tr></table></figure><p></p>
<p>create table rel.user_core_info(<br>user_id string,<br>age int,<br>gender string,<br>core int<br>)<br>row format delimited fields terminated by ‘\t’<br>lines terminated by ‘\n’<br>stored as textfile;</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">导入数据</span><br></pre></td></tr></table></figure><p></p>
<p>load data local inpath ‘/home/hadoop/apps/hive_test_data/user_core.txt’ into table rel.user_core_info;</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- 1. 条件函数 case when &lt;br&gt;</span><br><span class="line">语法1：CASE a WHEN b THEN c [WHEN d THEN e]* [ELSE f] END &lt;br&gt;</span><br><span class="line">说明：如果a等于b，那么返回c；如果a等于d，那么返回e；否则返回f</span><br><span class="line">例如：</span><br></pre></td></tr></table></figure><p></p>
<p>hive&gt; select case 1 when 2 then ‘two’ when 1 then ‘one’ else ‘zero’ end;<br>OK<br>one<br>Time taken: 0.152 seconds, Fetched: 1 row(s)</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">语法2：CASE WHEN a THEN b [WHEN c THEN d]* [ELSE e] END</span><br><span class="line">&lt;br&gt;</span><br><span class="line">说明：如果a为TRUE，则返回b；如果c为TRUE，则返回d；否则返回e</span><br><span class="line">例如：</span><br></pre></td></tr></table></figure><p></p>
<p>hive&gt; select case when 1=2 then ‘two’ when 1=1 then ‘one’ else ‘zero’ end;<br>OK<br>one<br>Time taken: 0.33 seconds, Fetched: 1 row(s)</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">查询用户评分表，每个年龄段的最大评分值</span><br></pre></td></tr></table></figure><p></p>
<p>select gender,<br>case when age&lt;=20 then ‘p0’ when age&gt;20 and age&lt;=50 then ‘p1’ when age&gt;=50 then ‘p3’ else ‘p0’ end,<br>max(core) max_core<br>from rel.user_core_info<br>group by gender,<br>case when age&lt;=20 then ‘p0’ when age&gt;20 and age&lt;=50 then ‘p1’ when age&gt;=50 then ‘p3’ else ‘p0’ end;</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">结果为：</span><br></pre></td></tr></table></figure><p></p>
<p>OK<br>female    p0    90<br>female    p1    95<br>female    p3    90<br>male    p0    80<br>male    p1    80<br>male    p3    80<br>Time taken: 28.461 seconds, Fetched: 6 row(s)</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- 2. 自定义UDF函数</span><br><span class="line"></span><br><span class="line">当Hive提供的内置函数无法满足你的业务处理需要时，此时就可以考虑使用用户自定义函数（UDF：user-defined function）。</span><br><span class="line">UDF 作用于单个数据行，产生一个数据行作为输出。</span><br><span class="line">步骤：</span><br><span class="line">1. 先开发一个java类，继承UDF，并重载evaluate方法</span><br><span class="line">2. 打成jar包上传到服务器</span><br><span class="line">3. 在使用的时候将jar包添加到hive的classpath</span><br></pre></td></tr></table></figure><p></p>
<p>hive&gt;add jar /home/hadoop/apps/hive_test_data/HiveUdfPro-1.0-SNAPSHOT.jar;</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4. 创建临时函数与开发好的java class关联</span><br></pre></td></tr></table></figure><p></p>
<p>hive&gt;create temporary function age_partition as ‘cn.chinahadoop.udf.AgePartitionFunction’;</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">5. 即可在hql中使用自定义的函数</span><br><span class="line">新建Maven 项目</span><br><span class="line">Pom 信息如下：</span><br></pre></td></tr></table></figure><p></p>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemalocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"><br>  <modelversion>4.0.0</modelversion><br><br>  <groupid>com.yongliang.udf</groupid><br>  <artifactid>HiveUdfPro</artifactid><br>  <version>1.0-SNAPSHOT</version><br>  <packaging>jar</packaging><br><br>  <name>HiveUdfPro</name><br>  <url><a href="http://maven.apache.org" target="_blank" rel="noopener">http://maven.apache.org</a></url><br>  <properties><br>    <project.build.sourceencoding>UTF-8</project.build.sourceencoding><br>  </properties><br>  <dependencies><br>    <dependency><br>      <groupid>org.apache.hive</groupid><br>      <artifactid>hive-exec</artifactid><br>      <version>1.2.2</version><br>    </dependency><br>    <dependency><br>      <groupid>org.apache.hadoop</groupid><br>      <artifactid>hadoop-common</artifactid><br>      <version>2.7.0</version><br>    </dependency><br>  </dependencies><br>  <build><br>    <plugins><br>      <plugin><br>        <groupid>org.apache.maven.plugins</groupid><br>        <artifactid>maven-compiler-plugin</artifactid><br>        <version>2.3.2</version><br>        <executions><br>          <execution><br>            <id>default-compile</id><br>            <phase>compile</phase><br>            <goals><br>              <goal>compile</goal><br>            </goals><br>            <configuration><br>              <encoding>UTF-8</encoding><br>            </configuration><br>          </execution><br>        </executions><br>      </plugin><br>    </plugins><br>  </build><br></project>

<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">新建类继承UDF</span><br></pre></td></tr></table></figure><p></p>
<p>package com.yongliang.udf;</p>
<p>import org.apache.hadoop.hive.ql.exec.UDF;<br>/**</p>
<ul>
<li>创建时间 : 2018/1/27 15:35</li>
<li>类描述 :  Hive UDF自定义函数，作用于单个数据行，产生一个数据行作为输出</li>
<li>@author  zhangyonglaing<br>*/<br>public class AgePartitionFunction extends UDF {<br> public String evaluate(int age) {<pre><code>String partition = &quot;p0&quot;;
if(age &lt;=20){
    partition = &quot;p0&quot;;
}else if(age &gt; 20 &amp;&amp; age &lt;=50){
    partition = &quot;p1&quot;;
}else if(age &gt; 50){
    partition = &quot;p2&quot;;
}
return partition;
</code></pre> }<br>}<br><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">将项目进行打包![Hive UDF 自定义函数](http://upload-images.jianshu.io/upload_images/1784853-a9280913d5aa3b96.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)</span><br><span class="line"></span><br><span class="line"> **说明:**</span><br><span class="line"> </span><br><span class="line"> **如出现以下异常信息：</span><br><span class="line">Failed to execute goal on project hive-exec: </span><br><span class="line">Could not resolve dependencies for project org.apache.hive:hive-exec:jar:2.3.0: </span><br><span class="line">Could not find artifact org.pentaho:pentaho-aggdesigner-algorithm:jar:5.1.5-jhyde in alimaven (http://maven.aliyun.com/nexus/content/groups/public/) -&gt; [Help 1]**</span><br><span class="line">![错误异常信息](http://upload-images.jianshu.io/upload_images/1784853-67071943803d5760?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240) &lt;br&gt;</span><br><span class="line">  请手动下载Jar包pentaho-aggdesigner-algorithm/5.1.5-jhyde.jar 下载地址：https://public.nexus.pentaho.org/content/groups/omni/org/pentaho/pentaho-aggdesigner-algorithm/5.1.5-jhyde/</span><br><span class="line">  将Jar包放置在本地Maven仓库org/pentaho/pentaho-aggdesigner-algorithm/5.1.5-jhyde路径下，之后进行重新打包。</span><br><span class="line">- 将jar包添加到hive的classpath</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>hive&gt; add jar /home/hadoop/apps/HiveUdfPro-1.0-SNAPSHOT.jar;<br>Added [/home/hadoop/apps/HiveUdfPro-1.0-SNAPSHOT.jar] to class path<br>Added resources: [/home/hadoop/apps/HiveUdfPro-1.0-SNAPSHOT.jar]</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">创建临时函数与开发好的java class关联</span><br></pre></td></tr></table></figure><p></p>
<p>hive&gt; create temporary function age_partition as ‘com.yongliang.udf.AgePartitionFunction’;</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在hql中使用自定义的函数</span><br></pre></td></tr></table></figure><p></p>
<p>select gender,<br>age_partition(age),<br>max(core) max_core<br>from rel.user_core_info<br>group by gender,<br>age_partition(age);</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">结果为：</span><br></pre></td></tr></table></figure><p></p>
<p>OK<br>female    p0    90<br>female    p1    95<br>female    p2    90<br>male    p0    80<br>male    p1    80<br>male    p2    80<br>```</p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2018-02-01T05:51:13.000Z" itemprop="dateUpdated">2018-02-01 13:51:13</time>
</span><br>


        
        这里可以写作者留言，标签和 hexo 中所有变量及辅助函数等均可调用，示例：<a href="/blogs/2018/02/01/Hive高级查询操作/" target="_blank" rel="external">https://yongliangzhang.github.io/blogs/2018/02/01/Hive高级查询操作/</a>
        
    </div>
    
    <footer>
        <a href="https://yongliangzhang.github.io/blogs">
            <img src="https://s1.ax2x.com/2018/01/31/ZL8UG.png" alt="YoungLiang">
            YoungLiang
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            

            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://yongliangzhang.github.io/blogs/2018/02/01/Hive高级查询操作/&title=《Hive高级操作》 — YoungLiang&pic=https://s1.ax2x.com/2018/01/31/ZL8UG.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://yongliangzhang.github.io/blogs/2018/02/01/Hive高级查询操作/&title=《Hive高级操作》 — YoungLiang&source=用心生活！创造非凡人生" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://yongliangzhang.github.io/blogs/2018/02/01/Hive高级查询操作/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Hive高级操作》 — YoungLiang&url=https://yongliangzhang.github.io/blogs/2018/02/01/Hive高级查询操作/&via=https://yongliangzhang.github.io/blogs" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://yongliangzhang.github.io/blogs/2018/02/01/Hive高级查询操作/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/blogs/2018/02/01/CentOS_7.2搭建FastDFS_分布式文件系统，实现高可用集群/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">CentOS 7.2搭建FastDFS 分布式文件系统，实现高可用集群</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/blogs/2018/01/30/hello-world/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Hello World</h4>
      </a>
    </div>
  
</nav>



    














</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="https://s1.ax2x.com/2018/02/01/Zxkyd.png" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="https://s1.ax2x.com/2018/02/01/Zxkyd.png" data-alipay="https://s1.ax2x.com/2018/02/01/ZxllR.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/blogs/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>This blog is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>YoungLiang &copy; 2015 - 2018</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://yongliangzhang.github.io/blogs/2018/02/01/Hive高级查询操作/&title=《Hive高级操作》 — YoungLiang&pic=https://s1.ax2x.com/2018/01/31/ZL8UG.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://yongliangzhang.github.io/blogs/2018/02/01/Hive高级查询操作/&title=《Hive高级操作》 — YoungLiang&source=用心生活！创造非凡人生" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://yongliangzhang.github.io/blogs/2018/02/01/Hive高级查询操作/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Hive高级操作》 — YoungLiang&url=https://yongliangzhang.github.io/blogs/2018/02/01/Hive高级查询操作/&via=https://yongliangzhang.github.io/blogs" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://yongliangzhang.github.io/blogs/2018/02/01/Hive高级查询操作/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACpElEQVR42u3awW6sQAwEwPz/TyfXJ0VA2x6TfVJxWmUJQ3HAvfZ8fcXH9z/H1bf3f7m62tX//v72/pqjAw8PD29w68mlk2UmvOSayT3j4eHhbfOSy+WY3gt9/ojx8PDwPpPXW/5+lftgjYeHh/f/8nqlYh6a8fDw8D6Tl8TZXjHIz6nyDvda8PDw8GJe75X9t59X5nt4eHh446l6PuDPr3ZqxBWthYeHh7fA29s6cN+izdu4eVi/bEng4eHhHeXlr/7e1oFqI7h3J5d/wcPDw1vgVX/858ucarPm0fnyynh4eHhHefPxVTW/522OauC+bEPg4eHhLfBONRrmjeDqNoVCAxcPDw/vKC+Ps70WbTXE5+Xn4TMeHh7eAm8SnavLFCZyrXHa5bd4eHh4C7xJo6EXzeePIy88eHh4eGd51Zf1JFhXb71XovDw8PC2efmwKonU1eHWqfg+2iWBh4eHV+RNxl15IUk2XfUe3EOxwcPDw1vjzUf783N6beIHBR4eHt6LvLNN216LNnnED+fj4eHhLfDmsTWPy5MmbHJXeHh4eO/wes2IXtidbFBolhA8PDy8Bd6p8JoPqPIHVN1wgIeHh/cOL3mt98ZUeUui2sIoPGI8PDy8BV7+Kq+WkN6WrDzQF+4NDw8Pb5k3GWKVN0UVGx/NQRoeHh7e67yktdprWEzaE4VojoeHh7fGK+84aIXdXpGYlCs8PDy8s7zv4lGYpxWLRy+yP2xQwMPDw1vg5UcVkw/GemOtXpnBw8PDO8XLt0b1Ynf1Ifa6Cnh4eHjv8/If+flNJJE3LxjN4I6Hh4f3AbyknFTHY0mzuBq78fDw8D6f14vF1UdWXhcPDw9vjZcvPC8b1XNGcR8PDw9vgdf7wT9vFiRRO9++gIeHh/cK7wdoVsBNusyn6gAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/blogs/', SHARE: true, REWARD: true };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '就这样走啦？';
            clearTimeout(titleTime);
        } else {
            document.title = '欢迎访问YoungLiang小站';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
