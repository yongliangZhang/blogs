<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    <title>CentOS 7.2搭建FastDFS 分布式文件系统，实现高可用集群 | YoungLiang | 生活充满乐趣与童真</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="">
    <meta name="description" content="分布式集群搭建结构 双Tracker 2组Group 轮询存储策略 Keepalived+Nginx高可用 Nginx缓存 4个存储节点  一、 集群规划清单1.安装清单   软件名称 版本 百度云盘存放名称     FastDFS 5.11 fastdfs-5.11.zip   FastDFS-Nginx-module 无 fastdfs-nginx-module-master.zip   Li">
<meta name="keywords" content="程序猿、跳舞爱好者、读书">
<meta property="og:type" content="article">
<meta property="og:title" content="CentOS 7.2搭建FastDFS 分布式文件系统，实现高可用集群">
<meta property="og:url" content="https://yongliangzhang.github.io/blogs/2018/02/01/CentOS_7.2搭建FastDFS_分布式文件系统，实现高可用集群/index.html">
<meta property="og:site_name" content="YoungLiang">
<meta property="og:description" content="分布式集群搭建结构 双Tracker 2组Group 轮询存储策略 Keepalived+Nginx高可用 Nginx缓存 4个存储节点  一、 集群规划清单1.安装清单   软件名称 版本 百度云盘存放名称     FastDFS 5.11 fastdfs-5.11.zip   FastDFS-Nginx-module 无 fastdfs-nginx-module-master.zip   Li">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1784853-ed325e68032fbca3?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:updated_time" content="2018-02-01T05:56:27.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CentOS 7.2搭建FastDFS 分布式文件系统，实现高可用集群">
<meta name="twitter:description" content="分布式集群搭建结构 双Tracker 2组Group 轮询存储策略 Keepalived+Nginx高可用 Nginx缓存 4个存储节点  一、 集群规划清单1.安装清单   软件名称 版本 百度云盘存放名称     FastDFS 5.11 fastdfs-5.11.zip   FastDFS-Nginx-module 无 fastdfs-nginx-module-master.zip   Li">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/1784853-ed325e68032fbca3?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
    
        <link rel="alternate" type="application/atom+xml" title="YoungLiang" href="/blogs/atom.xml">
    
    <link rel="shortcut icon" href="/blogs/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/blogs/img/brand.jpg)">
      <div class="brand">
        <a href="/blogs/" class="avatar waves-effect waves-circle waves-light">
          <img src="https://s1.ax2x.com/2018/01/31/ZL8UG.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">YoungLiang</h5>
          <a href="mailto:zhangyongliang1231@163.com" title="zhangyongliang1231@163.com" class="mail">zhangyongliang1231@163.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/blogs/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/blogs/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                历程
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/blogs/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/blogs/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/yongliangZhang" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://www.jianshu.com/u/31c3a36c409d" target="_blank" >
                <i class="icon icon-lg icon-book"></i>
                简书
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">CentOS 7.2搭建FastDFS 分布式文件系统，实现高可用集群</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">CentOS 7.2搭建FastDFS 分布式文件系统，实现高可用集群</h1>
        <h5 class="subtitle">
            
                <time datetime="2018-02-01T05:57:24.762Z" itemprop="datePublished" class="page-time">
  2018-02-01
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#分布式集群搭建结构"><span class="post-toc-number">1.</span> <span class="post-toc-text">分布式集群搭建结构</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#一、-集群规划清单"><span class="post-toc-number"></span> <span class="post-toc-text">一、 集群规划清单</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-安装清单"><span class="post-toc-number">0.1.</span> <span class="post-toc-text">1.安装清单</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-集群规划"><span class="post-toc-number">0.2.</span> <span class="post-toc-text">2.集群规划</span></a></li></ol></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#二、集群安装"><span class="post-toc-number"></span> <span class="post-toc-text">二、集群安装</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-安装LibFastCommon-FastDFS模块"><span class="post-toc-number">0.1.</span> <span class="post-toc-text">1.安装LibFastCommon/FastDFS模块</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-安装Tracker并实现节点信息配置"><span class="post-toc-number">1.</span> <span class="post-toc-text">2.安装Tracker并实现节点信息配置</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-安装Storage模块并实现配置"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">3.安装Storage模块并实现配置</span></a></li></ol></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#connect-timeout-in-seconds"><span class="post-toc-number"></span> <span class="post-toc-text">connect timeout in seconds</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#default-value-is-30s"><span class="post-toc-number"></span> <span class="post-toc-text">default value is 30s</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#network-recv-and-send-timeout-in-seconds"><span class="post-toc-number"></span> <span class="post-toc-text">network recv and send timeout in seconds</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#default-value-is-30s-1"><span class="post-toc-number"></span> <span class="post-toc-text">default value is 30s</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#the-base-path-to-store-log-files"><span class="post-toc-number"></span> <span class="post-toc-text">the base path to store log files</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#if-load-FastDFS-parameters-from-tracker-server"><span class="post-toc-number"></span> <span class="post-toc-text">if load FastDFS parameters from tracker server</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#since-V1-12"><span class="post-toc-number"></span> <span class="post-toc-text">since V1.12</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#default-value-is-false"><span class="post-toc-number"></span> <span class="post-toc-text">default value is false</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#storage-sync-file-max-delay-seconds"><span class="post-toc-number"></span> <span class="post-toc-text">storage sync file max delay seconds</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#same-as-tracker-conf"><span class="post-toc-number"></span> <span class="post-toc-text">same as tracker.conf</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#valid-only-when-load-fdfs-parameters-from-tracker-is-false"><span class="post-toc-number"></span> <span class="post-toc-text">valid only when load_fdfs_parameters_from_tracker is false</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#since-V1-12-1"><span class="post-toc-number"></span> <span class="post-toc-text">since V1.12</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#default-value-is-86400-seconds-one-day"><span class="post-toc-number"></span> <span class="post-toc-text">default value is 86400 seconds (one day)</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#if-use-storage-ID-instead-of-IP-address"><span class="post-toc-number"></span> <span class="post-toc-text">if use storage ID instead of IP address</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#same-as-tracker-conf-1"><span class="post-toc-number"></span> <span class="post-toc-text">same as tracker.conf</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#valid-only-when-load-fdfs-parameters-from-tracker-is-false-1"><span class="post-toc-number"></span> <span class="post-toc-text">valid only when load_fdfs_parameters_from_tracker is false</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#default-value-is-false-1"><span class="post-toc-number"></span> <span class="post-toc-text">default value is false</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#since-V1-13"><span class="post-toc-number"></span> <span class="post-toc-text">since V1.13</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#specify-storage-ids-filename-can-use-relative-or-absolute-path"><span class="post-toc-number"></span> <span class="post-toc-text">specify storage ids filename, can use relative or absolute path</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#same-as-tracker-conf-2"><span class="post-toc-number"></span> <span class="post-toc-text">same as tracker.conf</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#valid-only-when-load-fdfs-parameters-from-tracker-is-false-2"><span class="post-toc-number"></span> <span class="post-toc-text">valid only when load_fdfs_parameters_from_tracker is false</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#since-V1-13-1"><span class="post-toc-number"></span> <span class="post-toc-text">since V1.13</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#FastDFS-tracker-server-can-ocur-more-than-once-and-tracker-server-format-is"><span class="post-toc-number"></span> <span class="post-toc-text">FastDFS tracker_server can ocur more than once, and tracker_server format is</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#“host-port”-host-can-be-hostname-or-ip-address"><span class="post-toc-number"></span> <span class="post-toc-text">“host:port”, host can be hostname or ip address</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#valid-only-when-load-fdfs-parameters-from-tracker-is-true"><span class="post-toc-number"></span> <span class="post-toc-text">valid only when load_fdfs_parameters_from_tracker is true</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#the-port-of-the-local-storage-server"><span class="post-toc-number"></span> <span class="post-toc-text">the port of the local storage server</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#the-default-value-is-23000"><span class="post-toc-number"></span> <span class="post-toc-text">the default value is 23000</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#the-group-name-of-the-local-storage-server"><span class="post-toc-number"></span> <span class="post-toc-text">the group name of the local storage server</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#if-the-url-uri-including-the-group-name"><span class="post-toc-number"></span> <span class="post-toc-text">if the url / uri including the group name</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#set-to-false-when-uri-like-M00-00-00-xxx"><span class="post-toc-number"></span> <span class="post-toc-text">set to false when uri like /M00/00/00/xxx</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#set-to-true-when-uri-like-group-name-M00-00-00-xxx-such-as-group1-M00-xxx"><span class="post-toc-number"></span> <span class="post-toc-text">set to true when uri like ${group_name}/M00/00/00/xxx, such as group1/M00/xxx</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#default-value-is-false-2"><span class="post-toc-number"></span> <span class="post-toc-text">default value is false</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#path-disk-or-mount-point-count-default-value-is-1"><span class="post-toc-number"></span> <span class="post-toc-text">path(disk or mount point) count, default value is 1</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#must-same-as-storage-conf"><span class="post-toc-number"></span> <span class="post-toc-text">must same as storage.conf</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#store-path-based-0-if-store-path0-not-exists-it’s-value-is-base-path"><span class="post-toc-number"></span> <span class="post-toc-text">store_path#, based 0, if store_path0 not exists, it’s value is base_path</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#the-paths-must-be-exist"><span class="post-toc-number"></span> <span class="post-toc-text">the paths must be exist</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#must-same-as-storage-conf-1"><span class="post-toc-number"></span> <span class="post-toc-text">must same as storage.conf</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#standard-log-level-as-syslog-case-insensitive-value-list"><span class="post-toc-number"></span> <span class="post-toc-text">standard log level as syslog, case insensitive, value list:</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#emerg-for-emergency"><span class="post-toc-number">1.</span> <span class="post-toc-text">emerg for emergency</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#alert"><span class="post-toc-number">2.</span> <span class="post-toc-text">alert</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#crit-for-critical"><span class="post-toc-number">3.</span> <span class="post-toc-text">crit for critical</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#error"><span class="post-toc-number">4.</span> <span class="post-toc-text">error</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#warn-for-warning"><span class="post-toc-number">5.</span> <span class="post-toc-text">warn for warning</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#notice"><span class="post-toc-number">6.</span> <span class="post-toc-text">notice</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#info"><span class="post-toc-number">7.</span> <span class="post-toc-text">info</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#debug"><span class="post-toc-number">8.</span> <span class="post-toc-text">debug</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#set-the-log-filename-such-as-usr-local-apache2-logs-mod-fastdfs-log"><span class="post-toc-number"></span> <span class="post-toc-text">set the log filename, such as /usr/local/apache2/logs/mod_fastdfs.log</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#empty-for-output-to-stderr-apache-and-nginx-error-log-file"><span class="post-toc-number"></span> <span class="post-toc-text">empty for output to stderr (apache and nginx error_log file)</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#response-mode-when-the-file-not-exist-in-the-local-file-system"><span class="post-toc-number"></span> <span class="post-toc-text">response mode when the file not exist in the local file system</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#proxy-get-the-content-from-other-storage-server-then-send-to-client"><span class="post-toc-number"></span> <span class="post-toc-text">proxy: get the content from other storage server, then send to client</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#redirect-redirect-to-the-original-storage-server-HTTP-Header-is-Location"><span class="post-toc-number"></span> <span class="post-toc-text">redirect: redirect to the original storage server (HTTP Header is Location)</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#the-NIC-alias-prefix-such-as-eth-in-Linux-you-can-see-it-by-ifconfig-a"><span class="post-toc-number"></span> <span class="post-toc-text">the NIC alias prefix, such as eth in Linux, you can see it by ifconfig -a</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#multi-aliases-split-by-comma-empty-value-means-auto-set-by-OS-type"><span class="post-toc-number"></span> <span class="post-toc-text">multi aliases split by comma. empty value means auto set by OS type</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#this-paramter-used-to-get-all-ip-address-of-the-local-host"><span class="post-toc-number"></span> <span class="post-toc-text">this paramter used to get all ip address of the local host</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#default-values-is-empty"><span class="post-toc-number"></span> <span class="post-toc-text">default values is empty</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#use-“-include”-directive-to-include-HTTP-config-file"><span class="post-toc-number"></span> <span class="post-toc-text">use “#include” directive to include HTTP config file</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#NOTE-include-is-an-include-directive-do-NOT-remove-the-before-include"><span class="post-toc-number"></span> <span class="post-toc-text">NOTE: #include is an include directive, do NOT remove the # before include</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#if-support-flv"><span class="post-toc-number"></span> <span class="post-toc-text">if support flv</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#default-value-is-false-3"><span class="post-toc-number"></span> <span class="post-toc-text">default value is false</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#since-v1-15"><span class="post-toc-number"></span> <span class="post-toc-text">since v1.15</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#flv-file-extension-name"><span class="post-toc-number"></span> <span class="post-toc-text">flv file extension name</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#default-value-is-flv"><span class="post-toc-number"></span> <span class="post-toc-text">default value is flv</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#since-v1-15-1"><span class="post-toc-number"></span> <span class="post-toc-text">since v1.15</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#set-the-group-count"><span class="post-toc-number"></span> <span class="post-toc-text">set the group count</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#set-to-none-zero-to-support-multi-group-on-this-storage-server"><span class="post-toc-number"></span> <span class="post-toc-text">set to none zero to support multi-group on this storage server</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#set-to-0-for-single-group-only"><span class="post-toc-number"></span> <span class="post-toc-text">set to 0  for single group only</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#groups-settings-section-as-group1-group2-…-groupN"><span class="post-toc-number"></span> <span class="post-toc-text">groups settings section as [group1], [group2], …, [groupN]</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#default-value-is-0"><span class="post-toc-number"></span> <span class="post-toc-text">default value is 0</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#since-v1-14"><span class="post-toc-number"></span> <span class="post-toc-text">since v1.14</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#group-settings-for-group-1"><span class="post-toc-number"></span> <span class="post-toc-text">group settings for group #1</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#since-v1-14-1"><span class="post-toc-number"></span> <span class="post-toc-text">since v1.14</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#when-support-multi-group-on-this-storage-server-uncomment-following-section"><span class="post-toc-number"></span> <span class="post-toc-text">when support multi-group on this storage server, uncomment following section</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#group-settings-for-group-2"><span class="post-toc-number"></span> <span class="post-toc-text">group settings for group #2</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#since-v1-14-2"><span class="post-toc-number"></span> <span class="post-toc-text">since v1.14</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#when-support-multi-group-uncomment-following-section-as-neccessary"><span class="post-toc-number"></span> <span class="post-toc-text">when support multi-group, uncomment following section as neccessary</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#vi-usr-local-nginx-conf-nginx-conf"><span class="post-toc-number"></span> <span class="post-toc-text">vi /usr/local/nginx/conf/nginx.conf</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#vi-etc-fdfs-client-conf"><span class="post-toc-number"></span> <span class="post-toc-text">vi /etc/fdfs/client.conf</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#vi-usr-local-nginx-conf-nginx-conf-1"><span class="post-toc-number"></span> <span class="post-toc-text">vi /usr/local/nginx/conf/nginx.conf</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#THIS-FILE-IS-ADDED-FOR-COMPATIBILITY-PURPOSES"><span class="post-toc-number"></span> <span class="post-toc-text">THIS FILE IS ADDED FOR COMPATIBILITY PURPOSES</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#It-is-highly-advisable-to-create-own-systemd-services-or-udev-rules"><span class="post-toc-number"></span> <span class="post-toc-text">It is highly advisable to create own systemd services or udev rules</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#to-run-scripts-during-boot-instead-of-using-this-file"><span class="post-toc-number"></span> <span class="post-toc-text">to run scripts during boot instead of using this file.</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#In-contrast-to-previous-versions-due-to-parallel-execution-during-boot"><span class="post-toc-number"></span> <span class="post-toc-text">In contrast to previous versions due to parallel execution during boot</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#this-script-will-NOT-be-run-after-all-other-services"><span class="post-toc-number"></span> <span class="post-toc-text">this script will NOT be run after all other services.</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Please-note-that-you-must-run-‘chmod-x-etc-rc-d-rc-local’-to-ensure"><span class="post-toc-number"></span> <span class="post-toc-text">Please note that you must run ‘chmod +x /etc/rc.d/rc.local’ to ensure</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#that-this-script-will-be-executed-during-boot"><span class="post-toc-number"></span> <span class="post-toc-text">that this script will be executed during boot.</span></a>
        </nav>
    </aside>


<article id="post-CentOS_7.2搭建FastDFS_分布式文件系统，实现高可用集群"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">CentOS 7.2搭建FastDFS 分布式文件系统，实现高可用集群</h1>
        <div class="post-meta">
            <time class="post-time" title="2018-02-01 13:57:24" datetime="2018-02-01T05:57:24.762Z"  itemprop="datePublished">2018-02-01</time>

            


            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h3 id="分布式集群搭建结构"><a href="#分布式集群搭建结构" class="headerlink" title="分布式集群搭建结构"></a>分布式集群搭建结构</h3><ul>
<li>双Tracker</li>
<li>2组Group</li>
<li>轮询存储策略</li>
<li>Keepalived+Nginx高可用</li>
<li>Nginx缓存</li>
<li>4个存储节点</li>
</ul>
<h1 id="一、-集群规划清单"><a href="#一、-集群规划清单" class="headerlink" title="一、 集群规划清单"></a>一、 集群规划清单</h1><h4 id="1-安装清单"><a href="#1-安装清单" class="headerlink" title="1.安装清单"></a>1.安装清单</h4><table>
<thead>
<tr>
<th style="text-align:center">软件名称</th>
<th style="text-align:center">版本</th>
<th style="text-align:center">百度云盘存放名称</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">FastDFS</td>
<td style="text-align:center">5.11</td>
<td style="text-align:center">fastdfs-5.11.zip</td>
</tr>
<tr>
<td style="text-align:center">FastDFS-Nginx-module</td>
<td style="text-align:center">无</td>
<td style="text-align:center">fastdfs-nginx-module-master.zip</td>
</tr>
<tr>
<td style="text-align:center">LibFastCommon</td>
<td style="text-align:center">1.0.36</td>
<td style="text-align:center">libfastcommon-1.0.36.zip</td>
</tr>
<tr>
<td style="text-align:center">nginx</td>
<td style="text-align:center">1.10.3</td>
<td style="text-align:center">nginx-1.10.3.tar.gz</td>
</tr>
<tr>
<td style="text-align:center">nginx-pure-cache</td>
<td style="text-align:center">2.3</td>
<td style="text-align:center">ngx_cache_purge-2.3.tar.gz</td>
</tr>
</tbody>
</table>
<p><strong>安装所需文件均上传到百度云盘，位置<a href="https://pan.baidu.com/s/1htBiHoS" target="_blank" rel="noopener">：FastDFS百度云盘</a></strong></p>
<h4 id="2-集群规划"><a href="#2-集群规划" class="headerlink" title="2.集群规划"></a>2.集群规划</h4><table>
<thead>
<tr>
<th style="text-align:center">虚拟机</th>
<th style="text-align:center">IP</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Keepalived+Nginx1[Master]</td>
<td style="text-align:center">192.168.43.101</td>
<td style="text-align:center">Nginx Server 01</td>
</tr>
<tr>
<td style="text-align:center">Keeepalived+Nginx[Backup]</td>
<td style="text-align:center">192.168.43.102</td>
<td style="text-align:center">Nginx Server 02</td>
</tr>
<tr>
<td style="text-align:center">VIP</td>
<td style="text-align:center">192.168.43.150</td>
<td style="text-align:center">虚拟漂移IP</td>
</tr>
<tr>
<td style="text-align:center">Tracker01</td>
<td style="text-align:center">192.168.43.70</td>
<td style="text-align:center">Tracker01服务器</td>
</tr>
<tr>
<td style="text-align:center">Tracker02</td>
<td style="text-align:center">192.168.43.71</td>
<td style="text-align:center">Tracker02服务器</td>
</tr>
<tr>
<td style="text-align:center">Storage01</td>
<td style="text-align:center">192.168.43.72</td>
<td style="text-align:center">Storage01服务器【group1】</td>
</tr>
<tr>
<td style="text-align:center">Storage02</td>
<td style="text-align:center">192.168.43.73</td>
<td style="text-align:center">Storage02服务器【group1】</td>
</tr>
<tr>
<td style="text-align:center">Storage03</td>
<td style="text-align:center">192.168.43.74</td>
<td style="text-align:center">Storage03服务器【group2】</td>
</tr>
<tr>
<td style="text-align:center">Storage04</td>
<td style="text-align:center">192.168.43.75</td>
<td style="text-align:center">Storage04服务器【group2】</td>
</tr>
</tbody>
</table>
<p>整体架构图如下图所示：<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://upload-images.jianshu.io/upload_images/1784853-ed325e68032fbca3?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片来源：CSDN作者 liuyazhuang" title="">
                </div>
                <div class="image-caption">图片来源：CSDN作者 liuyazhuang</div>
            </figure></p>
<h1 id="二、集群安装"><a href="#二、集群安装" class="headerlink" title="二、集群安装"></a>二、集群安装</h1><p><strong>以下操作均在关闭所有节点防火墙进行的，请根据个人情况开启相关端口或关闭防火墙</strong></p>
<h4 id="1-安装LibFastCommon-FastDFS模块"><a href="#1-安装LibFastCommon-FastDFS模块" class="headerlink" title="1.安装LibFastCommon/FastDFS模块"></a>1.安装LibFastCommon/FastDFS模块</h4><p><strong>执行节点 Tracker01、Tracker02、Storage01、Storage03、Storage04</strong></p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fastDFS]# unzip libfastcommon-1.0.36.zip</span><br></pre></td></tr></table></figure><p></p>
<p>解压后目录如下：</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fastdfs-5.11]# ll</span><br><span class="line">[root@localhost libfastcommon-1.0.36]# ll</span><br><span class="line">总用量 32</span><br><span class="line">drwxr-xr-x. 2 root root  117 4月   5 2017 doc</span><br><span class="line">-rw-r--r--. 1 root root 8005 4月   5 2017 HISTORY</span><br><span class="line">-rw-r--r--. 1 root root  566 4月   5 2017 INSTALL</span><br><span class="line">-rw-r--r--. 1 root root 1606 4月   5 2017 libfastcommon.spec</span><br><span class="line">-rwxr-xr-x. 1 root root 3099 4月   5 2017 make.sh</span><br><span class="line">drwxr-xr-x. 2 root root  191 4月   5 2017 php-fastcommon</span><br><span class="line">-rw-r--r--. 1 root root 2763 4月   5 2017 README</span><br><span class="line">drwxr-xr-x. 3 root root 4096 1月  17 11:21 src</span><br></pre></td></tr></table></figure><p></p>
<p>安装C编译工具 gcc</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fastdfs-5.11]# yum -y install gcc-c++</span><br></pre></td></tr></table></figure><p></p>
<ul>
<li>安装装LibFastCommon</li>
</ul>
<p>编译libfastcommon软件并安装</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fastdfs-5.11]# ./make.sh  &amp;&amp; ./make.sh install</span><br></pre></td></tr></table></figure><p></p>
<p>为libcommon 创建软链接到/usr/local/lib目录下</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fastdfs-5.11]# ln -s /usr/lib64/libfastcommon.so /usr/local/lib/libfastcommon.so</span><br><span class="line">[root@localhost fastdfs-5.11]# ln -s /usr/lib64/libfastcommon.so /usr/lib/libfastcommon.so</span><br><span class="line">[root@localhost fastdfs-5.11]# ln -s /usr/lib64/libfdfsclient.so /usr/local/lib/libfdfsclient.so</span><br><span class="line">[root@localhost fastdfs-5.11]# ln -s /usr/lib64/libfdfsclient.so /usr/lib/libfdfsclient.so</span><br></pre></td></tr></table></figure><p></p>
<ul>
<li>安装FastDFS<br>解压安装包<br><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fastDFS]# unzip fastdfs-5.11.zip</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>进入解压目录并进行编译和安装</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fastDFS]# cd fastdfs-5.11/</span><br><span class="line">[root@localhost fastdfs-5.11]# ./make.sh  &amp;&amp; ./make.sh install</span><br></pre></td></tr></table></figure><p></p>
<p>安装成功后，FastDFS会安装在/etc/fdfs目录下：</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fastdfs-5.11]# ll /etc/fdfs/</span><br><span class="line">总用量 76</span><br><span class="line">-rw-r--r--. 1 root root   316 1月  17 11:47 client.conf</span><br><span class="line">-rw-r--r--. 1 root root  1461 1月  17 11:25 client.conf.sample</span><br><span class="line">-rw-r--r--. 1 root root   955 1月  17 13:20 http.conf</span><br><span class="line">-rw-r--r--. 1 root root 31172 1月  17 13:21 mime.types</span><br><span class="line">-rw-r--r--. 1 root root  3716 1月  17 12:57 mod_fastdfs.conf</span><br><span class="line">-rw-r--r--. 1 root root  1278 1月  17 11:40 storage.conf</span><br><span class="line">-rw-r--r--. 1 root root  7927 1月  17 11:25 storage.conf.sample</span><br><span class="line">-rw-r--r--. 1 root root   105 1月  17 11:25 storage_ids.conf.sample</span><br><span class="line">-rw-r--r--. 1 root root  1356 1月  17 11:34 tracker.conf</span><br><span class="line">-rw-r--r--. 1 root root  7389 1月  17 11:25 tracker.conf.sample</span><br></pre></td></tr></table></figure><p></p>
<p>我们需要把这三个示例文件复制一份，去掉.sample</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fdfs]# cp client.conf.sample client.conf</span><br><span class="line">[root@localhost fdfs]# cp storage.conf.sample storage.conf</span><br><span class="line">[root@localhost fdfs]# cp tracker.conf.sample tracker.conf</span><br></pre></td></tr></table></figure><p></p>
<p>FastDFS安装结束</p>
<h3 id="2-安装Tracker并实现节点信息配置"><a href="#2-安装Tracker并实现节点信息配置" class="headerlink" title="2.安装Tracker并实现节点信息配置"></a>2.安装Tracker并实现节点信息配置</h3><p><strong>执行节点 Tracker01、Tracker02</strong></p>
<ul>
<li>创建tracker工作目录</li>
</ul>
<p>此目录用于保存tracker 的data和log</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fdfs]# mkdir /opt/fastdfs_tracker</span><br></pre></td></tr></table></figure><p></p>
<ul>
<li>配置tracker</li>
</ul>
<p>配置 /etc/fdfs目录下tracker.conf<br>主要实现以下5个配置内容：</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.disabled=false </span><br><span class="line">2.port=22122 #默认端口号 </span><br><span class="line">3.base_path=/opt/fastdfs_tracker #我刚刚创建的目录 </span><br><span class="line">4.http.server_port=8080 #默认端口是8080</span><br><span class="line">5.store_lookup=0  #采用轮询策略进行存储，0 轮询 1：始终定向到某个group 2：负载进行存储文件</span><br></pre></td></tr></table></figure><p></p>
<p>完整tracker.conf 文件信息如下：</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">disabled=false</span><br><span class="line"></span><br><span class="line">bind_addr= 0.0.0.0</span><br><span class="line"></span><br><span class="line">port=22122</span><br><span class="line"></span><br><span class="line">connect_timeout=30</span><br><span class="line"></span><br><span class="line">network_timeout=60</span><br><span class="line"></span><br><span class="line">base_path=/opt/fastdfs_tracker</span><br><span class="line"></span><br><span class="line">max_connections=512</span><br><span class="line"></span><br><span class="line">accept_threads=1</span><br><span class="line"></span><br><span class="line">work_threads=4</span><br><span class="line"></span><br><span class="line">min_buff_size = 8KB</span><br><span class="line"></span><br><span class="line">max_buff_size = 128KB</span><br><span class="line"></span><br><span class="line">store_lookup=0</span><br><span class="line"></span><br><span class="line">store_group=group2</span><br><span class="line"></span><br><span class="line">store_server=0</span><br><span class="line"></span><br><span class="line">store_path=0</span><br><span class="line"></span><br><span class="line">download_server=0</span><br><span class="line"></span><br><span class="line">reserved_storage_space = 10%</span><br><span class="line"></span><br><span class="line">log_level=info</span><br><span class="line"></span><br><span class="line">run_by_group=</span><br><span class="line"></span><br><span class="line">run_by_user=</span><br><span class="line"></span><br><span class="line">allow_hosts=*</span><br><span class="line"></span><br><span class="line">sync_log_buff_interval = 10</span><br><span class="line"></span><br><span class="line">check_active_interval = 120</span><br><span class="line"></span><br><span class="line">thread_stack_size = 64KB</span><br><span class="line"></span><br><span class="line">storage_ip_changed_auto_adjust = true</span><br><span class="line"></span><br><span class="line">storage_sync_file_max_delay = 86400</span><br><span class="line"></span><br><span class="line">storage_sync_file_max_time = 300</span><br><span class="line"></span><br><span class="line">use_trunk_file = false </span><br><span class="line"></span><br><span class="line">slot_min_size = 256</span><br><span class="line"></span><br><span class="line">slot_max_size = 16MB</span><br><span class="line"></span><br><span class="line">trunk_file_size = 64MB</span><br><span class="line"></span><br><span class="line">trunk_create_file_advance = false</span><br><span class="line"></span><br><span class="line">trunk_create_file_time_base = 02:00</span><br><span class="line"></span><br><span class="line">trunk_create_file_interval = 86400</span><br><span class="line"></span><br><span class="line">trunk_create_file_space_threshold = 20G</span><br><span class="line"></span><br><span class="line">trunk_init_check_occupying = false</span><br><span class="line"></span><br><span class="line">trunk_init_reload_from_binlog = false</span><br><span class="line"></span><br><span class="line">trunk_compress_binlog_min_interval = 0</span><br><span class="line"></span><br><span class="line">use_storage_id = false</span><br><span class="line"></span><br><span class="line">storage_ids_filename = storage_ids.conf</span><br><span class="line"></span><br><span class="line">id_type_in_filename = ip</span><br><span class="line"></span><br><span class="line">store_slave_file_use_link = false</span><br><span class="line"></span><br><span class="line">rotate_error_log = false</span><br><span class="line"></span><br><span class="line">error_log_rotate_time=00:00</span><br><span class="line"></span><br><span class="line">rotate_error_log_size = 0</span><br><span class="line"></span><br><span class="line">log_file_keep_days = 0</span><br><span class="line"></span><br><span class="line">use_connection_pool = false</span><br><span class="line"></span><br><span class="line">connection_pool_max_idle_time = 3600</span><br><span class="line"></span><br><span class="line">http.server_port=8080</span><br><span class="line"></span><br><span class="line">http.check_alive_interval=30</span><br><span class="line"></span><br><span class="line">http.check_alive_type=tcp</span><br><span class="line"></span><br><span class="line">http.check_alive_uri=/status.html</span><br></pre></td></tr></table></figure><p></p>
<p>修改保存后创建软引用</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fdfs]# ln -s /usr/bin/fdfs_storaged /usr/local/bin</span><br></pre></td></tr></table></figure><p></p>
<ul>
<li>启动tracker，并加入开机启动项</li>
</ul>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fdfs]# service fdfs_trackerd start</span><br></pre></td></tr></table></figure><p></p>
<p>将tracker加入开机启动项</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fdfs]# echo &quot;service fdfs_trackerd start&quot; |tee -a /etc/rc.d/rc.local</span><br></pre></td></tr></table></figure><p></p>
<h4 id="3-安装Storage模块并实现配置"><a href="#3-安装Storage模块并实现配置" class="headerlink" title="3.安装Storage模块并实现配置"></a>3.安装Storage模块并实现配置</h4><p><strong>执行节点 Storage01、Storage02、Storage03、Storage04</strong></p>
<ul>
<li>建立存储目录</li>
</ul>
<p>在存储各节点建了两个目录fastdfs_storage_data,fastdfs_storage</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost opt]# mkdir fastdfs_storage</span><br><span class="line">[root@localhost opt]# mkdir fastdfs_storage_data</span><br><span class="line">[root@localhost opt]# ll</span><br><span class="line">总用量 0</span><br><span class="line">drwxr-xr-x. 4 root root 30 1月  17 11:45 fastdfs_storage</span><br><span class="line">drwxr-xr-x. 3 root root 18 1月  17 11:45 fastdfs_storage_data</span><br><span class="line">drwxr-xr-x. 4 root root 30 1月  17 11:35 fastdfs_tracker</span><br></pre></td></tr></table></figure><p></p>
<ul>
<li>修改存储节点目录下/etc/fdfs/storage.conf配置信息，具体如下：</li>
</ul>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">disabled=false #启用配置文件  </span><br><span class="line">group_name=group1 #组名（第一组为 group1， 第二组为 group2）  </span><br><span class="line">port=23000 #storage 的端口号,同一个组的 storage 端口号必须相同  </span><br><span class="line">base_path=/opt/fastdfs_storage #设置storage数据文件和日志目录 </span><br><span class="line">store_path0=/opt/fastdfs_storage_data #实际文件存储路径  </span><br><span class="line">store_path_count=1 #存储路径个数，需要和 store_path 个数匹配  </span><br><span class="line">tracker_server=192.168.43.70:22122 #tracker 服务器的 IP 地址和端口  </span><br><span class="line">tracker_server=192.168.43.70:22122 #多个 tracker 直接添加多条配置  </span><br><span class="line">http.server_port=8888 #设置 http 端口号</span><br></pre></td></tr></table></figure><p></p>
<p>完整配置信息如下：</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">disabled=false</span><br><span class="line">group_name=group1</span><br><span class="line">bind_addr=</span><br><span class="line">client_bind=true</span><br><span class="line">port=23000</span><br><span class="line">connect_timeout=30</span><br><span class="line">network_timeout=60</span><br><span class="line">heart_beat_interval=30</span><br><span class="line">stat_report_interval=60</span><br><span class="line">base_path=/opt/fastdfs_storage</span><br><span class="line">max_connections=256</span><br><span class="line">buff_size = 256KB</span><br><span class="line">accept_threads=1</span><br><span class="line">work_threads=4</span><br><span class="line">disk_rw_separated = true</span><br><span class="line">disk_reader_threads = 1</span><br><span class="line">disk_writer_threads = 1</span><br><span class="line">sync_wait_msec=50</span><br><span class="line">sync_interval=0</span><br><span class="line">sync_start_time=00:00</span><br><span class="line">sync_end_time=23:59</span><br><span class="line">write_mark_file_freq=500</span><br><span class="line">store_path_count=1</span><br><span class="line">store_path0=/opt/fastdfs_storage_data</span><br><span class="line">subdir_count_per_path=256</span><br><span class="line">tracker_server=192.168.43.70:22122</span><br><span class="line">tracker_server=192.168.43.71:22122</span><br><span class="line">log_level=info</span><br><span class="line">run_by_group=</span><br><span class="line">run_by_user=</span><br><span class="line">allow_hosts=*</span><br><span class="line">file_distribute_path_mode=0</span><br><span class="line">file_distribute_rotate_count=100</span><br><span class="line">fsync_after_written_bytes=0</span><br><span class="line">sync_log_buff_interval=10</span><br><span class="line">sync_binlog_buff_interval=10</span><br><span class="line">sync_stat_file_interval=300</span><br><span class="line">thread_stack_size=512KB</span><br><span class="line">upload_priority=10</span><br><span class="line">if_alias_prefix=</span><br><span class="line">check_file_duplicate=0</span><br><span class="line">file_signature_method=hash</span><br><span class="line">key_namespace=FastDFS</span><br><span class="line">keep_alive=0</span><br><span class="line">use_access_log = false</span><br><span class="line">rotate_access_log = false</span><br><span class="line">access_log_rotate_time=00:00</span><br><span class="line">rotate_error_log = false</span><br><span class="line">error_log_rotate_time=00:00</span><br><span class="line">rotate_access_log_size = 0</span><br><span class="line">rotate_error_log_size = 0</span><br><span class="line">log_file_keep_days = 0</span><br><span class="line">file_sync_skip_invalid_record=false</span><br><span class="line">use_connection_pool = false</span><br><span class="line">connection_pool_max_idle_time = 3600</span><br><span class="line">http.domain_name=</span><br><span class="line">http.server_port=8888</span><br></pre></td></tr></table></figure><p></p>
<ul>
<li>启动Storage<br>各节点配置好信息好之后，启动Storage</li>
</ul>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fdfs]# service fdfs_storaged start</span><br></pre></td></tr></table></figure><p></p>
<p>启动后查看日志情况</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fdfs]# fdfs_monitor /etc/fdfs/storage.conf</span><br><span class="line">[2018-01-20 16:56:48] DEBUG - base_path=/opt/fastdfs_storage, connect_timeout=30, network_timeout=60, tracker_server_count=2, anti_steal_token=0, anti_steal_secret_key length=0, use_connection_pool=0, g_connection_pool_max_idle_time=3600s, use_storage_id=0, storage server id count: 0</span><br><span class="line"></span><br><span class="line">server_count=2, server_index=0</span><br><span class="line"></span><br><span class="line">tracker server is 192.168.43.70:22122</span><br><span class="line"></span><br><span class="line">group count: 2</span><br><span class="line"></span><br><span class="line">Group 1:</span><br><span class="line">group name = group1</span><br><span class="line">disk total space = 47073 MB</span><br><span class="line">disk free space = 35162 MB</span><br><span class="line">trunk free space = 0 MB</span><br><span class="line">storage server count = 2</span><br><span class="line">active server count = 2</span><br><span class="line">storage server port = 23000</span><br><span class="line">storage HTTP port = 8888</span><br><span class="line">store path count = 1</span><br><span class="line">subdir count per path = 256</span><br><span class="line">current write server index = 0</span><br><span class="line">current trunk file id = 0</span><br><span class="line"></span><br><span class="line">	Storage 1:</span><br><span class="line">		id = 192.168.43.72</span><br><span class="line">		ip_addr = 192.168.43.72 (localhost.localdomain)  ACTIVE</span><br><span class="line">		http domain = </span><br><span class="line">		version = 5.11</span><br><span class="line">		join time = 2018-01-19 13:59:30</span><br><span class="line">		up time = 2018-01-20 12:37:18</span><br><span class="line">		total storage = 47073 MB</span><br><span class="line">		free storage = 35162 MB</span><br><span class="line">		upload priority = 10</span><br><span class="line">		store_path_count = 1</span><br><span class="line">		subdir_count_per_path = 256</span><br><span class="line">		storage_port = 23000</span><br><span class="line">		storage_http_port = 8888</span><br><span class="line">		current_write_path = 0</span><br><span class="line">		source storage id = </span><br><span class="line">		if_trunk_server = 0</span><br><span class="line">		connection.alloc_count = 256</span><br><span class="line">		connection.current_count = 1</span><br><span class="line">		connection.max_count = 1</span><br><span class="line">		total_upload_count = 3</span><br><span class="line">		success_upload_count = 3</span><br><span class="line">		total_append_count = 0</span><br><span class="line">		success_append_count = 0</span><br><span class="line">		total_modify_count = 0</span><br><span class="line">		success_modify_count = 0</span><br><span class="line">		total_truncate_count = 0</span><br><span class="line">		success_truncate_count = 0</span><br><span class="line">		total_set_meta_count = 0</span><br><span class="line">		success_set_meta_count = 0</span><br><span class="line">		total_delete_count = 0</span><br><span class="line">		success_delete_count = 0</span><br><span class="line">		total_download_count = 0</span><br><span class="line">		success_download_count = 0</span><br><span class="line">		total_get_meta_count = 0</span><br><span class="line">		success_get_meta_count = 0</span><br><span class="line">		total_create_link_count = 0</span><br><span class="line">		success_create_link_count = 0</span><br><span class="line">		total_delete_link_count = 0</span><br><span class="line">		success_delete_link_count = 0</span><br><span class="line">		total_upload_bytes = 791904</span><br><span class="line">		success_upload_bytes = 791904</span><br><span class="line">		total_append_bytes = 0</span><br><span class="line">		success_append_bytes = 0</span><br><span class="line">		total_modify_bytes = 0</span><br><span class="line">		success_modify_bytes = 0</span><br><span class="line">		stotal_download_bytes = 0</span><br><span class="line">		success_download_bytes = 0</span><br><span class="line">		total_sync_in_bytes = 775234</span><br><span class="line">		success_sync_in_bytes = 775234</span><br><span class="line">		total_sync_out_bytes = 0</span><br><span class="line">		success_sync_out_bytes = 0</span><br><span class="line">		total_file_open_count = 4</span><br><span class="line">		success_file_open_count = 4</span><br><span class="line">		total_file_read_count = 0</span><br><span class="line">		success_file_read_count = 0</span><br><span class="line">		total_file_write_count = 8</span><br><span class="line">		success_file_write_count = 8</span><br><span class="line">		last_heart_beat_time = 2018-01-20 16:56:18</span><br><span class="line">		last_source_update = 2018-01-19 19:34:55</span><br><span class="line">		last_sync_update = 2018-01-19 15:28:56</span><br><span class="line">		last_synced_timestamp = 2018-01-19 15:28:48 (0s delay)</span><br><span class="line">	Storage 2:</span><br><span class="line">		id = 192.168.43.73</span><br><span class="line">		ip_addr = 192.168.43.73  ACTIVE</span><br><span class="line">		http domain = </span><br><span class="line">		version = 5.11</span><br><span class="line">		join time = 2018-01-19 14:00:21</span><br><span class="line">		up time = 2018-01-20 12:37:42</span><br><span class="line">		total storage = 47073 MB</span><br><span class="line">		free storage = 35166 MB</span><br><span class="line">		upload priority = 10</span><br><span class="line">		store_path_count = 1</span><br><span class="line">		subdir_count_per_path = 256</span><br><span class="line">		storage_port = 23000</span><br><span class="line">		storage_http_port = 8888</span><br><span class="line">		current_write_path = 0</span><br><span class="line">		source storage id = 192.168.43.72</span><br><span class="line">		if_trunk_server = 0</span><br><span class="line">		connection.alloc_count = 256</span><br><span class="line">		connection.current_count = 1</span><br><span class="line">		connection.max_count = 1</span><br><span class="line">		total_upload_count = 1</span><br><span class="line">		success_upload_count = 1</span><br><span class="line">		total_append_count = 0</span><br><span class="line">		success_append_count = 0</span><br><span class="line">		total_modify_count = 0</span><br><span class="line">		success_modify_count = 0</span><br><span class="line">		total_truncate_count = 0</span><br><span class="line">		success_truncate_count = 0</span><br><span class="line">		total_set_meta_count = 0</span><br><span class="line">		success_set_meta_count = 0</span><br><span class="line">		total_delete_count = 0</span><br><span class="line">		success_delete_count = 0</span><br><span class="line">		total_download_count = 0</span><br><span class="line">		success_download_count = 0</span><br><span class="line">		total_get_meta_count = 0</span><br><span class="line">		success_get_meta_count = 0</span><br><span class="line">		total_create_link_count = 0</span><br><span class="line">		success_create_link_count = 0</span><br><span class="line">		total_delete_link_count = 0</span><br><span class="line">		success_delete_link_count = 0</span><br><span class="line">		total_upload_bytes = 775234</span><br><span class="line">		success_upload_bytes = 775234</span><br><span class="line">		total_append_bytes = 0</span><br><span class="line">		success_append_bytes = 0</span><br><span class="line">		total_modify_bytes = 0</span><br><span class="line">		success_modify_bytes = 0</span><br><span class="line">		stotal_download_bytes = 0</span><br><span class="line">		success_download_bytes = 0</span><br><span class="line">		total_sync_in_bytes = 791904</span><br><span class="line">		success_sync_in_bytes = 791904</span><br><span class="line">		total_sync_out_bytes = 0</span><br><span class="line">		success_sync_out_bytes = 0</span><br><span class="line">		total_file_open_count = 4</span><br><span class="line">		success_file_open_count = 4</span><br><span class="line">		total_file_read_count = 0</span><br><span class="line">		success_file_read_count = 0</span><br><span class="line">		total_file_write_count = 8</span><br><span class="line">		success_file_write_count = 8</span><br><span class="line">		last_heart_beat_time = 2018-01-20 16:56:42</span><br><span class="line">		last_source_update = 2018-01-19 15:28:48</span><br><span class="line">		last_sync_update = 2018-01-19 19:34:59</span><br><span class="line">		last_synced_timestamp = 2018-01-19 19:34:55 (0s delay)</span><br><span class="line"></span><br><span class="line">Group 2:</span><br><span class="line">group name = group2</span><br><span class="line">disk total space = 47073 MB</span><br><span class="line">disk free space = 35165 MB</span><br><span class="line">trunk free space = 0 MB</span><br><span class="line">storage server count = 2</span><br><span class="line">active server count = 2</span><br><span class="line">storage server port = 23000</span><br><span class="line">storage HTTP port = 8888</span><br><span class="line">store path count = 1</span><br><span class="line">subdir count per path = 256</span><br><span class="line">current write server index = 0</span><br><span class="line">current trunk file id = 0</span><br><span class="line"></span><br><span class="line">	Storage 1:</span><br><span class="line">		id = 192.168.43.74</span><br><span class="line">		ip_addr = 192.168.43.74  ACTIVE</span><br><span class="line">		http domain = </span><br><span class="line">		version = 5.11</span><br><span class="line">		join time = 2018-01-19 14:01:05</span><br><span class="line">		up time = 2018-01-20 12:38:00</span><br><span class="line">		total storage = 47073 MB</span><br><span class="line">		free storage = 35165 MB</span><br><span class="line">		upload priority = 10</span><br><span class="line">		store_path_count = 1</span><br><span class="line">		subdir_count_per_path = 256</span><br><span class="line">		storage_port = 23000</span><br><span class="line">		storage_http_port = 8888</span><br><span class="line">		current_write_path = 0</span><br><span class="line">		source storage id = </span><br><span class="line">		if_trunk_server = 0</span><br><span class="line">		connection.alloc_count = 256</span><br><span class="line">		connection.current_count = 1</span><br><span class="line">		connection.max_count = 1</span><br><span class="line">		total_upload_count = 4</span><br><span class="line">		success_upload_count = 4</span><br><span class="line">		total_append_count = 0</span><br><span class="line">		success_append_count = 0</span><br><span class="line">		total_modify_count = 0</span><br><span class="line">		success_modify_count = 0</span><br><span class="line">		total_truncate_count = 0</span><br><span class="line">		success_truncate_count = 0</span><br><span class="line">		total_set_meta_count = 0</span><br><span class="line">		success_set_meta_count = 0</span><br><span class="line">		total_delete_count = 0</span><br><span class="line">		success_delete_count = 0</span><br><span class="line">		total_download_count = 0</span><br><span class="line">		success_download_count = 0</span><br><span class="line">		total_get_meta_count = 0</span><br><span class="line">		success_get_meta_count = 0</span><br><span class="line">		total_create_link_count = 0</span><br><span class="line">		success_create_link_count = 0</span><br><span class="line">		total_delete_link_count = 0</span><br><span class="line">		success_delete_link_count = 0</span><br><span class="line">		total_upload_bytes = 2107770</span><br><span class="line">		success_upload_bytes = 2107770</span><br><span class="line">		total_append_bytes = 0</span><br><span class="line">		success_append_bytes = 0</span><br><span class="line">		total_modify_bytes = 0</span><br><span class="line">		success_modify_bytes = 0</span><br><span class="line">		stotal_download_bytes = 0</span><br><span class="line">		success_download_bytes = 0</span><br><span class="line">		total_sync_in_bytes = 1550468</span><br><span class="line">		success_sync_in_bytes = 1550468</span><br><span class="line">		total_sync_out_bytes = 0</span><br><span class="line">		success_sync_out_bytes = 0</span><br><span class="line">		total_file_open_count = 6</span><br><span class="line">		success_file_open_count = 6</span><br><span class="line">		total_file_read_count = 0</span><br><span class="line">		success_file_read_count = 0</span><br><span class="line">		total_file_write_count = 15</span><br><span class="line">		success_file_write_count = 15</span><br><span class="line">		last_heart_beat_time = 2018-01-20 16:56:38</span><br><span class="line">		last_source_update = 2018-01-19 19:35:40</span><br><span class="line">		last_sync_update = 2018-01-19 15:28:53</span><br><span class="line">		last_synced_timestamp = 2018-01-19 15:28:50 (-1s delay)</span><br><span class="line">	Storage 2:</span><br><span class="line">		id = 192.168.43.75</span><br><span class="line">		ip_addr = 192.168.43.75  ACTIVE</span><br><span class="line">		http domain = </span><br><span class="line">		version = 5.11</span><br><span class="line">		join time = 2018-01-19 14:01:27</span><br><span class="line">		up time = 2018-01-20 12:38:20</span><br><span class="line">		total storage = 47073 MB</span><br><span class="line">		free storage = 35165 MB</span><br><span class="line">		upload priority = 10</span><br><span class="line">		store_path_count = 1</span><br><span class="line">		subdir_count_per_path = 256</span><br><span class="line">		storage_port = 23000</span><br><span class="line">		storage_http_port = 8888</span><br><span class="line">		current_write_path = 0</span><br><span class="line">		source storage id = 192.168.43.74</span><br><span class="line">		if_trunk_server = 0</span><br><span class="line">		connection.alloc_count = 256</span><br><span class="line">		connection.current_count = 1</span><br><span class="line">		connection.max_count = 1</span><br><span class="line">		total_upload_count = 2</span><br><span class="line">		success_upload_count = 2</span><br><span class="line">		total_append_count = 0</span><br><span class="line">		success_append_count = 0</span><br><span class="line">		total_modify_count = 0</span><br><span class="line">		success_modify_count = 0</span><br><span class="line">		total_truncate_count = 0</span><br><span class="line">		success_truncate_count = 0</span><br><span class="line">		total_set_meta_count = 0</span><br><span class="line">		success_set_meta_count = 0</span><br><span class="line">		total_delete_count = 0</span><br><span class="line">		success_delete_count = 0</span><br><span class="line">		total_download_count = 0</span><br><span class="line">		success_download_count = 0</span><br><span class="line">		total_get_meta_count = 0</span><br><span class="line">		success_get_meta_count = 0</span><br><span class="line">		total_create_link_count = 0</span><br><span class="line">		success_create_link_count = 0</span><br><span class="line">		total_delete_link_count = 0</span><br><span class="line">		success_delete_link_count = 0</span><br><span class="line">		total_upload_bytes = 1550468</span><br><span class="line">		success_upload_bytes = 1550468</span><br><span class="line">		total_append_bytes = 0</span><br><span class="line">		success_append_bytes = 0</span><br><span class="line">		total_modify_bytes = 0</span><br><span class="line">		success_modify_bytes = 0</span><br><span class="line">		stotal_download_bytes = 0</span><br><span class="line">		success_download_bytes = 0</span><br><span class="line">		total_sync_in_bytes = 2107770</span><br><span class="line">		success_sync_in_bytes = 2107770</span><br><span class="line">		total_sync_out_bytes = 0</span><br><span class="line">		success_sync_out_bytes = 0</span><br><span class="line">		total_file_open_count = 6</span><br><span class="line">		success_file_open_count = 6</span><br><span class="line">		total_file_read_count = 0</span><br><span class="line">		success_file_read_count = 0</span><br><span class="line">		total_file_write_count = 15</span><br><span class="line">		success_file_write_count = 15</span><br><span class="line">		last_heart_beat_time = 2018-01-20 16:56:23</span><br><span class="line">		last_source_update = 2018-01-19 15:28:49</span><br><span class="line">		last_sync_update = 2018-01-19 19:35:46</span><br><span class="line">		last_synced_timestamp = 2018-01-19 19:35:40 (0s delay)</span><br></pre></td></tr></table></figure><p></p>
<p>如果看到有2组Storage信息，则表示配置信息配置成功，并注册到Tracker中，查看日志启动情况</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fdfs]# tail -f /opt/fastdfs_storage/logs/storaged.log </span><br><span class="line"></span><br><span class="line">[2018-01-20 12:37:18] INFO - FastDFS v5.11, base_path=/opt/fastdfs_storage, store_path_count=1, subdir_count_per_path=256, group_name=group1, run_by_group=, run_by_user=, connect_timeout=30s, network_timeout=60s, port=23000, bind_addr=, client_bind=1, max_connections=256, accept_threads=1, work_threads=4, disk_rw_separated=1, disk_reader_threads=1, disk_writer_threads=1, buff_size=256KB, heart_beat_interval=30s, stat_report_interval=60s, tracker_server_count=2, sync_wait_msec=50ms, sync_interval=0ms, sync_start_time=00:00, sync_end_time=23:59, write_mark_file_freq=500, allow_ip_count=-1, file_distribute_path_mode=0, file_distribute_rotate_count=100, fsync_after_written_bytes=0, sync_log_buff_interval=10s, sync_binlog_buff_interval=10s, sync_stat_file_interval=300s, thread_stack_size=512 KB, upload_priority=10, if_alias_prefix=, check_file_duplicate=0, file_signature_method=hash, FDHT group count=0, FDHT server count=0, FDHT key_namespace=, FDHT keep_alive=0, HTTP server port=8888, domain name=, use_access_log=0, rotate_access_log=0, access_log_rotate_time=00:00, rotate_error_log=0, error_log_rotate_time=00:00, rotate_access_log_size=0, rotate_error_log_size=0, log_file_keep_days=0, file_sync_skip_invalid_record=0, use_connection_pool=0, g_connection_pool_max_idle_time=3600s</span><br><span class="line">[2018-01-20 12:37:18] INFO - file: storage_param_getter.c, line: 191, use_storage_id=0, id_type_in_filename=ip, storage_ip_changed_auto_adjust=1, store_path=0, reserved_storage_space=10.00%, use_trunk_file=0, slot_min_size=256, slot_max_size=16 MB, trunk_file_size=64 MB, trunk_create_file_advance=0, trunk_create_file_time_base=02:00, trunk_create_file_interval=86400, trunk_create_file_space_threshold=20 GB, trunk_init_check_occupying=0, trunk_init_reload_from_binlog=0, trunk_compress_binlog_min_interval=0, store_slave_file_use_link=0</span><br><span class="line">[2018-01-20 12:37:18] INFO - file: storage_func.c, line: 257, tracker_client_ip: 192.168.43.72, my_server_id_str: 192.168.43.72, g_server_id_in_filename: 1210820800</span><br><span class="line">[2018-01-20 12:37:18] INFO - file: tracker_client_thread.c, line: 310, successfully connect to tracker server 192.168.43.71:22122, as a tracker client, my ip is 192.168.43.72</span><br><span class="line">[2018-01-20 12:37:18] INFO - file: tracker_client_thread.c, line: 1947, tracker server: #0. 192.168.43.70:22122, my_report_status: -1</span><br><span class="line">[2018-01-20 12:37:18] INFO - file: tracker_client_thread.c, line: 310, successfully connect to tracker server 192.168.43.70:22122, as a tracker client, my ip is 192.168.43.72</span><br><span class="line">[2018-01-20 12:37:18] INFO - file: tracker_client_thread.c, line: 1947, tracker server: #0. 192.168.43.70:22122, my_report_status: -1</span><br><span class="line">[2018-01-20 12:37:48] INFO - file: tracker_client_thread.c, line: 1263, tracker server 192.168.43.71:22122, set tracker leader: 192.168.43.71:22122</span><br><span class="line">[2018-01-20 12:37:48] INFO - file: storage_sync.c, line: 2732, successfully connect to storage server 192.168.43.73:23000</span><br></pre></td></tr></table></figure><p></p>
<p>发现此时192.168.43.71作为Tracker的Leader。</p>
<ul>
<li>设置Storage开机自启动</li>
</ul>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fdfs]#  echo &quot;service fdfs_storaged start&quot; |tee -a /etc/rc.d/rc.local</span><br></pre></td></tr></table></figure><p></p>
<ul>
<li>安装fastdfs-nginx-module、Nginx模块</li>
</ul>
<p>安装Nginx模块所需的依赖环境</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fdfs]# yum -y install pcre pcre-devel  </span><br><span class="line">[root@localhost fdfs]# yum -y install zlib zlib-devel  </span><br><span class="line">[root@localhost fdfs]# yum -y install openssl openssl-devel</span><br></pre></td></tr></table></figure><p></p>
<p>解压nginx和fastdfs-nginx-module</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fdfs]# tar -zxvf nginx-1.10.3.tar.gz</span><br><span class="line">[root@localhost fdfs]# unzip fastdfs-nginx-module-master.zip</span><br></pre></td></tr></table></figure><p></p>
<p>进入Nginx解压目录进行编译安装</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost nginx-1.10.3]# ./configure --prefix=/usr/local/nginx --add-module=/home/zhangyongliang/apps/fastdfs-nginx-module-master/src #解压后fastdfs-nginx-module所在的位置</span><br></pre></td></tr></table></figure><p></p>
<p>安装成功后，nginx会安装在/usr/local/nginx,安装后查看</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost src]# ll /usr/local/nginx/</span><br><span class="line">总用量 8</span><br><span class="line">drwx------. 2 nobody root    6 1月  17 13:23 client_body_temp</span><br><span class="line">drwxr-xr-x. 2 root   root 4096 1月  17 13:17 conf</span><br><span class="line">drwx------. 2 nobody root    6 1月  17 13:23 fastcgi_temp</span><br><span class="line">drwxr-xr-x. 2 root   root   40 1月  17 13:17 html</span><br><span class="line">drwxr-xr-x. 2 root   root   58 1月  17 13:49 logs</span><br><span class="line">-rw-r--r--. 1 root   root 1156 1月  17 13:29 nginx.conf</span><br><span class="line">drwx------. 2 nobody root    6 1月  17 13:23 proxy_temp</span><br><span class="line">drwxr-xr-x. 2 root   root   19 1月  17 13:17 sbin</span><br><span class="line">drwx------. 2 nobody root    6 1月  17 13:23 scgi_temp</span><br><span class="line">drwx------. 2 nobody root    6 1月  17 13:23 uwsgi_temp</span><br></pre></td></tr></table></figure><p></p>
<p>安装成功后，nginx尚未运行时，nginx文件夹没有临时文件夹，例如fastcgi_temp这些文件。<br><br><br>复制 fastdfs-nginx-module 源码中的配置文件到/etc/fdfs 目录， 并修改</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost src]# cp /usr/local/src/fastdfs-nginx-module/src/mod_fastdfs.conf /etc/fdfs/  </span><br><span class="line">[root@localhost src]# vi /etc/fdfs/mod_fastdfs.conf</span><br></pre></td></tr></table></figure><p></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">(1)第1组 Storage 的 mod_fastdfs.conf 配置如下：  </span><br><span class="line">connect_timeout=10  </span><br><span class="line">base_path=/opt/fastdfs_storage</span><br><span class="line">tracker_server=192.168.1.131:22122  </span><br><span class="line">tracker_server=192.168.1.132:22122  </span><br><span class="line">storage_server_port=23000  </span><br><span class="line">group_name=group1  </span><br><span class="line">url_have_group_name = true  </span><br><span class="line">store_path0=/opt/fastdfs_storage_data</span><br><span class="line">group_count = 2  </span><br><span class="line">[group1]  </span><br><span class="line">group_name=group1  </span><br><span class="line">storage_server_port=23000  </span><br><span class="line">store_path_count=1  </span><br><span class="line">store_path0=/opt/fastdfs_storage_data</span><br><span class="line">[group2]  </span><br><span class="line">group_name=group2  </span><br><span class="line">storage_server_port=23000  </span><br><span class="line">store_path_count=1  </span><br><span class="line">store_path0=/opt/fastdfs_storage_data </span><br><span class="line">(2)第2组 Storage 的 mod_fastdfs.conf 配置与第一组配置只有 group_name 不同：  </span><br><span class="line">group_name=group2  </span><br><span class="line">&lt;p class=&quot;code-caption&quot; data-lang=&quot;&quot; data-line_number=&quot;frontend&quot; data-trim_indent=&quot;backend&quot; data-label_position=&quot;outer&quot; data-labels_left=&quot;Code&quot; data-labels_right=&quot;:&quot; data-labels_copy=&quot;Copy Code&quot;&gt;&lt;span class=&quot;code-caption-label&quot;&gt;&lt;/span&gt;&lt;a class=&quot;code-caption-copy&quot;&gt;Copy Code&lt;/a&gt;&lt;/p&gt;</span><br><span class="line">```  </span><br><span class="line">完整信息如下：</span><br></pre></td></tr></table></figure>
<h1 id="connect-timeout-in-seconds"><a href="#connect-timeout-in-seconds" class="headerlink" title="connect timeout in seconds"></a>connect timeout in seconds</h1><h1 id="default-value-is-30s"><a href="#default-value-is-30s" class="headerlink" title="default value is 30s"></a>default value is 30s</h1><p>connect_timeout=2</p>
<h1 id="network-recv-and-send-timeout-in-seconds"><a href="#network-recv-and-send-timeout-in-seconds" class="headerlink" title="network recv and send timeout in seconds"></a>network recv and send timeout in seconds</h1><h1 id="default-value-is-30s-1"><a href="#default-value-is-30s-1" class="headerlink" title="default value is 30s"></a>default value is 30s</h1><p>network_timeout=30</p>
<h1 id="the-base-path-to-store-log-files"><a href="#the-base-path-to-store-log-files" class="headerlink" title="the base path to store log files"></a>the base path to store log files</h1><p>base_path=/opt/fastdfs_storage</p>
<h1 id="if-load-FastDFS-parameters-from-tracker-server"><a href="#if-load-FastDFS-parameters-from-tracker-server" class="headerlink" title="if load FastDFS parameters from tracker server"></a>if load FastDFS parameters from tracker server</h1><h1 id="since-V1-12"><a href="#since-V1-12" class="headerlink" title="since V1.12"></a>since V1.12</h1><h1 id="default-value-is-false"><a href="#default-value-is-false" class="headerlink" title="default value is false"></a>default value is false</h1><p>load_fdfs_parameters_from_tracker=true</p>
<h1 id="storage-sync-file-max-delay-seconds"><a href="#storage-sync-file-max-delay-seconds" class="headerlink" title="storage sync file max delay seconds"></a>storage sync file max delay seconds</h1><h1 id="same-as-tracker-conf"><a href="#same-as-tracker-conf" class="headerlink" title="same as tracker.conf"></a>same as tracker.conf</h1><h1 id="valid-only-when-load-fdfs-parameters-from-tracker-is-false"><a href="#valid-only-when-load-fdfs-parameters-from-tracker-is-false" class="headerlink" title="valid only when load_fdfs_parameters_from_tracker is false"></a>valid only when load_fdfs_parameters_from_tracker is false</h1><h1 id="since-V1-12-1"><a href="#since-V1-12-1" class="headerlink" title="since V1.12"></a>since V1.12</h1><h1 id="default-value-is-86400-seconds-one-day"><a href="#default-value-is-86400-seconds-one-day" class="headerlink" title="default value is 86400 seconds (one day)"></a>default value is 86400 seconds (one day)</h1><p>storage_sync_file_max_delay = 86400</p>
<h1 id="if-use-storage-ID-instead-of-IP-address"><a href="#if-use-storage-ID-instead-of-IP-address" class="headerlink" title="if use storage ID instead of IP address"></a>if use storage ID instead of IP address</h1><h1 id="same-as-tracker-conf-1"><a href="#same-as-tracker-conf-1" class="headerlink" title="same as tracker.conf"></a>same as tracker.conf</h1><h1 id="valid-only-when-load-fdfs-parameters-from-tracker-is-false-1"><a href="#valid-only-when-load-fdfs-parameters-from-tracker-is-false-1" class="headerlink" title="valid only when load_fdfs_parameters_from_tracker is false"></a>valid only when load_fdfs_parameters_from_tracker is false</h1><h1 id="default-value-is-false-1"><a href="#default-value-is-false-1" class="headerlink" title="default value is false"></a>default value is false</h1><h1 id="since-V1-13"><a href="#since-V1-13" class="headerlink" title="since V1.13"></a>since V1.13</h1><p>use_storage_id = false</p>
<h1 id="specify-storage-ids-filename-can-use-relative-or-absolute-path"><a href="#specify-storage-ids-filename-can-use-relative-or-absolute-path" class="headerlink" title="specify storage ids filename, can use relative or absolute path"></a>specify storage ids filename, can use relative or absolute path</h1><h1 id="same-as-tracker-conf-2"><a href="#same-as-tracker-conf-2" class="headerlink" title="same as tracker.conf"></a>same as tracker.conf</h1><h1 id="valid-only-when-load-fdfs-parameters-from-tracker-is-false-2"><a href="#valid-only-when-load-fdfs-parameters-from-tracker-is-false-2" class="headerlink" title="valid only when load_fdfs_parameters_from_tracker is false"></a>valid only when load_fdfs_parameters_from_tracker is false</h1><h1 id="since-V1-13-1"><a href="#since-V1-13-1" class="headerlink" title="since V1.13"></a>since V1.13</h1><p>storage_ids_filename = storage_ids.conf</p>
<h1 id="FastDFS-tracker-server-can-ocur-more-than-once-and-tracker-server-format-is"><a href="#FastDFS-tracker-server-can-ocur-more-than-once-and-tracker-server-format-is" class="headerlink" title="FastDFS tracker_server can ocur more than once, and tracker_server format is"></a>FastDFS tracker_server can ocur more than once, and tracker_server format is</h1><h1 id="“host-port”-host-can-be-hostname-or-ip-address"><a href="#“host-port”-host-can-be-hostname-or-ip-address" class="headerlink" title="“host:port”, host can be hostname or ip address"></a>“host:port”, host can be hostname or ip address</h1><h1 id="valid-only-when-load-fdfs-parameters-from-tracker-is-true"><a href="#valid-only-when-load-fdfs-parameters-from-tracker-is-true" class="headerlink" title="valid only when load_fdfs_parameters_from_tracker is true"></a>valid only when load_fdfs_parameters_from_tracker is true</h1><p>tracker_server=192.168.43.70:22122<br>tracker_server=192.168.43.71:22122</p>
<h1 id="the-port-of-the-local-storage-server"><a href="#the-port-of-the-local-storage-server" class="headerlink" title="the port of the local storage server"></a>the port of the local storage server</h1><h1 id="the-default-value-is-23000"><a href="#the-default-value-is-23000" class="headerlink" title="the default value is 23000"></a>the default value is 23000</h1><p>storage_server_port=23000</p>
<h1 id="the-group-name-of-the-local-storage-server"><a href="#the-group-name-of-the-local-storage-server" class="headerlink" title="the group name of the local storage server"></a>the group name of the local storage server</h1><p>group_name=group1</p>
<h1 id="if-the-url-uri-including-the-group-name"><a href="#if-the-url-uri-including-the-group-name" class="headerlink" title="if the url / uri including the group name"></a>if the url / uri including the group name</h1><h1 id="set-to-false-when-uri-like-M00-00-00-xxx"><a href="#set-to-false-when-uri-like-M00-00-00-xxx" class="headerlink" title="set to false when uri like /M00/00/00/xxx"></a>set to false when uri like /M00/00/00/xxx</h1><h1 id="set-to-true-when-uri-like-group-name-M00-00-00-xxx-such-as-group1-M00-xxx"><a href="#set-to-true-when-uri-like-group-name-M00-00-00-xxx-such-as-group1-M00-xxx" class="headerlink" title="set to true when uri like ${group_name}/M00/00/00/xxx, such as group1/M00/xxx"></a>set to true when uri like ${group_name}/M00/00/00/xxx, such as group1/M00/xxx</h1><h1 id="default-value-is-false-2"><a href="#default-value-is-false-2" class="headerlink" title="default value is false"></a>default value is false</h1><p>url_have_group_name = true</p>
<h1 id="path-disk-or-mount-point-count-default-value-is-1"><a href="#path-disk-or-mount-point-count-default-value-is-1" class="headerlink" title="path(disk or mount point) count, default value is 1"></a>path(disk or mount point) count, default value is 1</h1><h1 id="must-same-as-storage-conf"><a href="#must-same-as-storage-conf" class="headerlink" title="must same as storage.conf"></a>must same as storage.conf</h1><p>store_path_count=1</p>
<h1 id="store-path-based-0-if-store-path0-not-exists-it’s-value-is-base-path"><a href="#store-path-based-0-if-store-path0-not-exists-it’s-value-is-base-path" class="headerlink" title="store_path#, based 0, if store_path0 not exists, it’s value is base_path"></a>store_path#, based 0, if store_path0 not exists, it’s value is base_path</h1><h1 id="the-paths-must-be-exist"><a href="#the-paths-must-be-exist" class="headerlink" title="the paths must be exist"></a>the paths must be exist</h1><h1 id="must-same-as-storage-conf-1"><a href="#must-same-as-storage-conf-1" class="headerlink" title="must same as storage.conf"></a>must same as storage.conf</h1><p>store_path0=/opt/fastdfs_storage_data</p>
<p>#store_path1=/home/yuqing/fastdfs1</p>
<h1 id="standard-log-level-as-syslog-case-insensitive-value-list"><a href="#standard-log-level-as-syslog-case-insensitive-value-list" class="headerlink" title="standard log level as syslog, case insensitive, value list:"></a>standard log level as syslog, case insensitive, value list:</h1><h3 id="emerg-for-emergency"><a href="#emerg-for-emergency" class="headerlink" title="emerg for emergency"></a>emerg for emergency</h3><h3 id="alert"><a href="#alert" class="headerlink" title="alert"></a>alert</h3><h3 id="crit-for-critical"><a href="#crit-for-critical" class="headerlink" title="crit for critical"></a>crit for critical</h3><h3 id="error"><a href="#error" class="headerlink" title="error"></a>error</h3><h3 id="warn-for-warning"><a href="#warn-for-warning" class="headerlink" title="warn for warning"></a>warn for warning</h3><h3 id="notice"><a href="#notice" class="headerlink" title="notice"></a>notice</h3><h3 id="info"><a href="#info" class="headerlink" title="info"></a>info</h3><h3 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h3><p>log_level=info</p>
<h1 id="set-the-log-filename-such-as-usr-local-apache2-logs-mod-fastdfs-log"><a href="#set-the-log-filename-such-as-usr-local-apache2-logs-mod-fastdfs-log" class="headerlink" title="set the log filename, such as /usr/local/apache2/logs/mod_fastdfs.log"></a>set the log filename, such as /usr/local/apache2/logs/mod_fastdfs.log</h1><h1 id="empty-for-output-to-stderr-apache-and-nginx-error-log-file"><a href="#empty-for-output-to-stderr-apache-and-nginx-error-log-file" class="headerlink" title="empty for output to stderr (apache and nginx error_log file)"></a>empty for output to stderr (apache and nginx error_log file)</h1><p>log_filename=</p>
<h1 id="response-mode-when-the-file-not-exist-in-the-local-file-system"><a href="#response-mode-when-the-file-not-exist-in-the-local-file-system" class="headerlink" title="response mode when the file not exist in the local file system"></a>response mode when the file not exist in the local file system</h1><h2 id="proxy-get-the-content-from-other-storage-server-then-send-to-client"><a href="#proxy-get-the-content-from-other-storage-server-then-send-to-client" class="headerlink" title="proxy: get the content from other storage server, then send to client"></a>proxy: get the content from other storage server, then send to client</h2><h2 id="redirect-redirect-to-the-original-storage-server-HTTP-Header-is-Location"><a href="#redirect-redirect-to-the-original-storage-server-HTTP-Header-is-Location" class="headerlink" title="redirect: redirect to the original storage server (HTTP Header is Location)"></a>redirect: redirect to the original storage server (HTTP Header is Location)</h2><p>response_mode=proxy</p>
<h1 id="the-NIC-alias-prefix-such-as-eth-in-Linux-you-can-see-it-by-ifconfig-a"><a href="#the-NIC-alias-prefix-such-as-eth-in-Linux-you-can-see-it-by-ifconfig-a" class="headerlink" title="the NIC alias prefix, such as eth in Linux, you can see it by ifconfig -a"></a>the NIC alias prefix, such as eth in Linux, you can see it by ifconfig -a</h1><h1 id="multi-aliases-split-by-comma-empty-value-means-auto-set-by-OS-type"><a href="#multi-aliases-split-by-comma-empty-value-means-auto-set-by-OS-type" class="headerlink" title="multi aliases split by comma. empty value means auto set by OS type"></a>multi aliases split by comma. empty value means auto set by OS type</h1><h1 id="this-paramter-used-to-get-all-ip-address-of-the-local-host"><a href="#this-paramter-used-to-get-all-ip-address-of-the-local-host" class="headerlink" title="this paramter used to get all ip address of the local host"></a>this paramter used to get all ip address of the local host</h1><h1 id="default-values-is-empty"><a href="#default-values-is-empty" class="headerlink" title="default values is empty"></a>default values is empty</h1><p>if_alias_prefix=</p>
<h1 id="use-“-include”-directive-to-include-HTTP-config-file"><a href="#use-“-include”-directive-to-include-HTTP-config-file" class="headerlink" title="use “#include” directive to include HTTP config file"></a>use “#include” directive to include HTTP config file</h1><h1 id="NOTE-include-is-an-include-directive-do-NOT-remove-the-before-include"><a href="#NOTE-include-is-an-include-directive-do-NOT-remove-the-before-include" class="headerlink" title="NOTE: #include is an include directive, do NOT remove the # before include"></a>NOTE: #include is an include directive, do NOT remove the # before include</h1><p>#include http.conf</p>
<h1 id="if-support-flv"><a href="#if-support-flv" class="headerlink" title="if support flv"></a>if support flv</h1><h1 id="default-value-is-false-3"><a href="#default-value-is-false-3" class="headerlink" title="default value is false"></a>default value is false</h1><h1 id="since-v1-15"><a href="#since-v1-15" class="headerlink" title="since v1.15"></a>since v1.15</h1><p>flv_support = true</p>
<h1 id="flv-file-extension-name"><a href="#flv-file-extension-name" class="headerlink" title="flv file extension name"></a>flv file extension name</h1><h1 id="default-value-is-flv"><a href="#default-value-is-flv" class="headerlink" title="default value is flv"></a>default value is flv</h1><h1 id="since-v1-15-1"><a href="#since-v1-15-1" class="headerlink" title="since v1.15"></a>since v1.15</h1><p>flv_extension = flv</p>
<h1 id="set-the-group-count"><a href="#set-the-group-count" class="headerlink" title="set the group count"></a>set the group count</h1><h1 id="set-to-none-zero-to-support-multi-group-on-this-storage-server"><a href="#set-to-none-zero-to-support-multi-group-on-this-storage-server" class="headerlink" title="set to none zero to support multi-group on this storage server"></a>set to none zero to support multi-group on this storage server</h1><h1 id="set-to-0-for-single-group-only"><a href="#set-to-0-for-single-group-only" class="headerlink" title="set to 0  for single group only"></a>set to 0  for single group only</h1><h1 id="groups-settings-section-as-group1-group2-…-groupN"><a href="#groups-settings-section-as-group1-group2-…-groupN" class="headerlink" title="groups settings section as [group1], [group2], …, [groupN]"></a>groups settings section as [group1], [group2], …, [groupN]</h1><h1 id="default-value-is-0"><a href="#default-value-is-0" class="headerlink" title="default value is 0"></a>default value is 0</h1><h1 id="since-v1-14"><a href="#since-v1-14" class="headerlink" title="since v1.14"></a>since v1.14</h1><p>group_count = 2</p>
<h1 id="group-settings-for-group-1"><a href="#group-settings-for-group-1" class="headerlink" title="group settings for group #1"></a>group settings for group #1</h1><h1 id="since-v1-14-1"><a href="#since-v1-14-1" class="headerlink" title="since v1.14"></a>since v1.14</h1><h1 id="when-support-multi-group-on-this-storage-server-uncomment-following-section"><a href="#when-support-multi-group-on-this-storage-server-uncomment-following-section" class="headerlink" title="when support multi-group on this storage server, uncomment following section"></a>when support multi-group on this storage server, uncomment following section</h1><p>[group1]<br>group_name=group1<br>storage_server_port=23000<br>store_path_count=1<br>store_path0=/opt/fastdfs_storage_data<br>[group2]<br>group_name=group2<br>storage_server_port=23000<br>store_path_count=1<br>store_path0=/opt/fastdfs_storage_data</p>
<h1 id="group-settings-for-group-2"><a href="#group-settings-for-group-2" class="headerlink" title="group settings for group #2"></a>group settings for group #2</h1><h1 id="since-v1-14-2"><a href="#since-v1-14-2" class="headerlink" title="since v1.14"></a>since v1.14</h1><h1 id="when-support-multi-group-uncomment-following-section-as-neccessary"><a href="#when-support-multi-group-uncomment-following-section-as-neccessary" class="headerlink" title="when support multi-group, uncomment following section as neccessary"></a>when support multi-group, uncomment following section as neccessary</h1><p>#[group2]</p>
<p>#group_name=group2</p>
<p>#storage_server_port=23000</p>
<p>#store_path_count=1</p>
<p>#store_path0=/home/yuqing/fastdfs</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">复制 FastDFS 安装目录的部分配置文件到/etc/fdfs 目录</span><br></pre></td></tr></table></figure><p></p>
<p>[root@localhost conf]# pwd<br>/home/zhangyongliang/apps/fastdfs-5.11/conf<br>[root@localhost conf]# cp http.conf  mime.types  /etc/fdfs/</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">创建M00至storage存储目录的符号连接：</span><br></pre></td></tr></table></figure><p></p>
<p>ln  -s  /opt/fastdfs_storage_data/data/ /opt/fastdfs_storage_data/data/M00</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">配置 Nginx， 简洁版 nginx 配置样例</span><br></pre></td></tr></table></figure><p></p>
<h1 id="vi-usr-local-nginx-conf-nginx-conf"><a href="#vi-usr-local-nginx-conf-nginx-conf" class="headerlink" title="vi /usr/local/nginx/conf/nginx.conf"></a>vi /usr/local/nginx/conf/nginx.conf</h1><p>user root;<br>worker_processes 1;<br>events {<br>    worker_connections 1024;<br>}<br>http {<br>    include mime.types;<br>    default_type application/octet-stream;<br>    sendfile on;<br>    keepalive_timeout 65;<br>    server {<br>        listen 8888;<br>        server_name localhost;<br>        location ~/group([0-9])/M00 {  </p>
<pre><code>        #alias /fastdfs/storage/data;  
        ngx_fastdfs_module;  
    }  
    error_page 500 502 503 504 /50x.html;  
    location = /50x.html {  
        root html;  
    }  
}  
</code></pre><p>}  </p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">注意、 说明：&lt;br&gt;</span><br><span class="line"> 8888 端口值是要与/etc/fdfs/storage.conf 中的 http.server_port=8888 相对应，因为 http.server_port 默认为 8888,如果想改成 80，则要对应修改过来。&lt;br&gt;</span><br><span class="line">重新启动各节点的Nginx服务</span><br></pre></td></tr></table></figure><p></p>
<p>[root@localhost conf]#/usr/local/nginx/sbin/nginx -s reload</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#### 4.文件上传测试</span><br><span class="line">**执行节点Tracker01、Tracker02**&lt;br&gt;</span><br><span class="line">修改 Tracker 服务器中的客户端配置文件</span><br></pre></td></tr></table></figure><p></p>
<h1 id="vi-etc-fdfs-client-conf"><a href="#vi-etc-fdfs-client-conf" class="headerlink" title="vi /etc/fdfs/client.conf"></a>vi /etc/fdfs/client.conf</h1><p>base_path=/fastdfs/tracker<br>tracker_server=192.168.43.70:22122<br>tracker_server=192.168.43.71:22122  </p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">执行如下文件上传命令</span><br></pre></td></tr></table></figure><p></p>
<p>[root@localhost zhangyongliang]# fdfs_upload_file /etc/fdfs/client.conf P71022-205803.jpg<br>group1/M00/00/00/wKgrSFpjC26AH1g2AAvUQrxXbkA557.jpg<br>[root@localhost zhangyongliang]# fdfs_upload_file /etc/fdfs/client.conf P71022-205803.jpg<br>group2/M00/00/00/wKgrSlpjC3aAARrXAAvUQrxXbkA048.jpg</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">进行2次上传后，发现文件被均衡分到2个group。</span><br><span class="line">#### 5.Tracker安装Nginx、 ngx_cache_purge 模块</span><br><span class="line">- 安装编译 Nginx 所需的依赖包</span><br></pre></td></tr></table></figure><p></p>
<p>[root@localhost zhangyongliang]# yum install gcc gcc-c++ make automake autoconf libtool pcre pcre-devel zlib zlib-devel openssl openssl-devel  </p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">解压Nginx和ngx_cache_pure模块</span><br></pre></td></tr></table></figure><p></p>
<p>[root@localhost apps]# tar ngx_cache_purge-2.3.tar.gz<br>[root@localhost apps]# tar nginx-1.10.3.tar.gz </p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">编译安装 Nginx（添加 ngx_cache_purge 模块）</span><br></pre></td></tr></table></figure><p></p>
<p>[root@localhost apps]# cd nginx-1.13.0<br>[root@localhost nginx-1.13.0# ./configure –prefix=/usr/local/nginx –add-module=/usr/local/src/ngx_cache_purge-2.3<br>[root@localhost nginx-1.13.0]# make &amp;&amp; make install </p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">配置 Nginx， 设置负载均衡以及缓存</span><br></pre></td></tr></table></figure><p></p>
<h1 id="vi-usr-local-nginx-conf-nginx-conf-1"><a href="#vi-usr-local-nginx-conf-nginx-conf-1" class="headerlink" title="vi /usr/local/nginx/conf/nginx.conf"></a>vi /usr/local/nginx/conf/nginx.conf</h1><p>#user  nobody;<br>worker_processes  1;</p>
<p>#error_log  logs/error.log;</p>
<p>#error_log  logs/error.log  notice;</p>
<p>#error_log  logs/error.log  info;</p>
<p>#pid        logs/nginx.pid;</p>
<p>events {<br>    worker_connections  1024;<br>}</p>
<p>http {<br>    include       mime.types;<br>    default_type  application/octet-stream;</p>
<pre><code>#log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;
#                  &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;
#                  &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;

#access_log  logs/access.log  main;
sendfile        on;  
tcp_nopush      on;  
#tcp_nopush     on;
#keepalive_timeout  0;
keepalive_timeout  65;

#gzip  on;
#设置缓存  
server_names_hash_bucket_size 128;  
client_header_buffer_size 32k;  
large_client_header_buffers 4 32k;  
client_max_body_size 300m;  

proxy_redirect off;  
proxy_set_header Host $http_host;  
proxy_set_header X-Real-IP $remote_addr;  
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;  
proxy_connect_timeout 90;  
proxy_send_timeout 90;  
proxy_read_timeout 90;  
proxy_buffer_size 16k;  
proxy_buffers 4 64k;  
proxy_busy_buffers_size 128k;  
proxy_temp_file_write_size 128k;
#设置缓存存储路径，存储方式，分别内存大小，磁盘最大空间，缓存期限  
proxy_cache_path /opt/fastdfs_tracker/proxy_cache levels=1:2 
keys_zone=http-cache:200m max_size=1g inactive=30d;
proxy_temp_path /opt/fastdfs_tracker/tmp;
#group1的服务设置  
upstream fdfs_group1 {  
     server 192.168.43.72:8888 weight=1 max_fails=2 fail_timeout=30s;  
     server 192.168.43.73:8888 weight=1 max_fails=2 fail_timeout=30s;  
}
#group2的服务设置  
upstream fdfs_group2 {  
     server 192.168.43.74:8888 weight=1 max_fails=2 fail_timeout=30s;  
     server 192.168.43.75:8888 weight=1 max_fails=2 fail_timeout=30s;  
}

server {
    listen       8000;
    server_name  localhost;

    #charset koi8-r;

    #access_log  logs/host.access.log  main;
    #group1的负载均衡配置  
    location /group1/M00 {  
        proxy_next_upstream http_502 http_504 error timeout invalid_header;  
        proxy_cache http-cache;  
        proxy_cache_valid 200 304 12h;  
        proxy_cache_key $uri$is_args$args;  
        #对应group1的服务设置  
        proxy_pass http://fdfs_group1;  
        expires 30d;  
    }
    location /group2/M00 {  
        proxy_next_upstream http_502 http_504 error timeout invalid_header;  
        proxy_cache http-cache;  
        proxy_cache_valid 200 304 12h;  
        proxy_cache_key $uri$is_args$args;  
        #对应group2的服务设置  
        proxy_pass http://fdfs_group2;  
        expires 30d;  
     }
    location ~/purge(/.*) {  
        allow 127.0.0.1;  
        allow 192.168.43.0/24;  
        deny all;  
        proxy_cache_purge http-cache $1$is_args$args;  
    }          
    location / {
        root   html;
        index  index.html index.htm;
    }

    #error_page  404              /404.html;

    # redirect server error pages to the static page /50x.html
    #
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   html;
    }

    # proxy the PHP scripts to Apache listening on 127.0.0.1:80
    #
    #location ~ \.php$ {
    #    proxy_pass   http://127.0.0.1;
    #}

    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
    #
    #location ~ \.php$ {
    #    root           html;
    #    fastcgi_pass   127.0.0.1:9000;
    #    fastcgi_index  index.php;
    #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
    #    include        fastcgi_params;
    #}

    # deny access to .htaccess files, if Apache&apos;s document root
    # concurs with nginx&apos;s one
    #
    #location ~ /\.ht {
    #    deny  all;
    #}
}


# another virtual host using mix of IP-, name-, and port-based configuration
#
#server {
#    listen       8000;
#    listen       somename:8080;
#    server_name  somename  alias  another.alias;

#    location / {
#        root   html;
#        index  index.html index.htm;
#    }
#}


# HTTPS server
#
#server {
#    listen       443 ssl;
#    server_name  localhost;

#    ssl_certificate      cert.pem;
#    ssl_certificate_key  cert.key;

#    ssl_session_cache    shared:SSL:1m;
#    ssl_session_timeout  5m;

#    ssl_ciphers  HIGH:!aNULL:!MD5;
#    ssl_prefer_server_ciphers  on;

#    location / {
#        root   html;
#        index  index.html index.htm;
#    }
#}
</code></pre><p>}</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">根据Nginx配置，创建对应目录下的文件夹</span><br></pre></td></tr></table></figure><p></p>
<p>[root@localhost fastdfs_tracker]# mkdir proxy_cache tmp<br>[root@localhost fastdfs_tracker]# ll<br>总用量 0<br>drwxr-xr-x. 2 root   root 178 1月  20 12:37 data<br>drwxr-xr-x. 2 root   root  26 1月  19 12:01 logs<br>drwxr-xr-x. 7 nobody root  51 1月  19 19:35 proxy_cache<br>drwxr-xr-x. 2 nobody root   6 1月  19 19:35 tmp</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">重启Nginx进行访问测试</span><br></pre></td></tr></table></figure><p></p>
<p>重启 Nginx<br>[root@localhost fastdfs_tracker]# /usr/local/nginx/sbin/nginx -s reload </p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">前面直接通过访问 Storage 节点中的 Nginx 的文件&lt;br&gt;</span><br><span class="line">http://192.168.43.72:8888/group1/M00/00/00/wKgrSFpjC26AH1g2AAvUQrxXbkA557.jpg]&lt;br&gt;</span><br><span class="line">http://192.168.43.74:8888/group2/M00/00/00/wKgrSlpjC3aAARrXAAvUQrxXbkA048.jpg&lt;br&gt;</span><br><span class="line">现在可以通过 Tracker 中的 Nginx 来进行访问&lt;br&gt;</span><br><span class="line">(1)通过 Tracker1 中的 Nginx 来访问&lt;br&gt;</span><br><span class="line">http://192.168.43.70:8000/group1/M00/00/00/wKgrSFpjC26AH1g2AAvUQrxXbkA557.jpg&lt;br&gt;</span><br><span class="line">http://192.168.43.70:8000/group2/M00/00/00/wKgrSlpjC3aAARrXAAvUQrxXbkA048.jpg&lt;br&gt;</span><br><span class="line">(2)通过 Tracker2 中的 Nginx 来访问&lt;br&gt;</span><br><span class="line">http://192.168.43.71:8000/group1/M00/00/00/wKgrSFpjC26AH1g2AAvUQrxXbkA557.jpg&lt;br&gt;</span><br><span class="line">http://192.168.50.71:8000/group2/M00/00/00/wKgrSlpjC3aAARrXAAvUQrxXbkA048.jpg&lt;br&gt;</span><br><span class="line">#### 6.构建Keepalive+Nginx 实现虚拟IP的代理</span><br><span class="line">关于使用Keepalive+Nginx进行代理的环境安装，请参考本人简书此文[：Keepalived+Nginx+Tomcat 实现高可用Web集群</span><br><span class="line">](https://www.jianshu.com/p/bc34f9101c5e)</span><br><span class="line">本文不再做赘述说明&lt;br&gt;</span><br><span class="line">- 启动Keepalvie+nginx Master主节点【192.168.43.101】</span><br><span class="line">- 启动Keepalvie+nginx BackUp备节点【192.168.43.102】</span><br><span class="line">&lt;br&gt;</span><br><span class="line">修改2个节点Nginx下目录的nginx.conf的配置文件信息，添加如下内容&lt;br&gt;</span><br><span class="line">主要内容为2个Tracker加入到Keepalive+nginx代理当中</span><br></pre></td></tr></table></figure><p></p>
<p>upstream fastdfs_tracker {<br>   server 192.168.43.70:8000 weight=1 max_fails=2 fail_timeout=30s;<br>   server 192.168.43.71:8000 weight=1 max_fails=2 fail_timeout=30s;<br>}  </p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">第二处修改是添加了一个location并且匹配规则是路径当中有fastdfs</span><br></pre></td></tr></table></figure><p></p>
<p>location /fastdfs {<br>           root html;<br>           index index.html index.htm;<br>           proxy_pass <a href="http://fastdfs_tracker/" target="_blank" rel="noopener">http://fastdfs_tracker/</a>;<br>           proxy_set_header Host $http_host;<br>           proxy_set_header Cookie $http_cookie;<br>           proxy_set_header X-Real-IP $remote_addr;<br>           proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>           proxy_set_header X-Forwarded-Proto $scheme;<br>           client_max_body_size 300m;<br>        }  </p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">完整配置代码如下：</span><br></pre></td></tr></table></figure><p></p>
<p>#user  nobody;<br>worker_processes  1;</p>
<p>#error_log  logs/error.log;</p>
<p>#error_log  logs/error.log  notice;</p>
<p>#error_log  logs/error.log  info;</p>
<p>#pid        logs/nginx.pid;</p>
<p>events {<br>    worker_connections  1024;<br>}</p>
<p>http {<br>    include       mime.types;<br>    default_type  application/octet-stream;</p>
<pre><code>#log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;
#                  &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;
#                  &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;

#access_log  logs/access.log  main;

sendfile        on;
#tcp_nopush     on;

#keepalive_timeout  0;
keepalive_timeout  65;

#gzip  on;
upstream fastdfs_tracker {  
   server 192.168.43.70:8000 weight=1 max_fails=2 fail_timeout=30s;  
   server 192.168.43.71:8000 weight=1 max_fails=2 fail_timeout=30s;  
}  
upstream tomcat{
 server 192.168.43.103:8080 weight=1;
 server 192.168.43.104:8080 weight=1;
}

server {
    listen       80;
    server_name  localhost;

    #charset koi8-r;

    #access_log  logs/host.access.log  main;

    location / {
        proxy_pass http://tomcat;
        proxy_set_header X-NGINX &quot;NGINX-1&quot;;
        root   html;
        index  index.html index.htm;
    }

    #error_page  404              /404.html;

    # redirect server error pages to the static page /50x.html
    #
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   html;
    }
    location /fastdfs {  
       root html;  
       index index.html index.htm;  
       proxy_pass http://fastdfs_tracker/;  
       proxy_set_header Host $http_host;  
       proxy_set_header Cookie $http_cookie;  
       proxy_set_header X-Real-IP $remote_addr;  
       proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;  
       proxy_set_header X-Forwarded-Proto $scheme;  
       client_max_body_size 300m;  
    }  

    # proxy the PHP scripts to Apache listening on 127.0.0.1:80
    #
    #location ~ \.php$ {
    #    proxy_pass   http://127.0.0.1;
    #}

    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
    #
    #location ~ \.php$ {
    #    root           html;
    #    fastcgi_pass   127.0.0.1:9000;
    #    fastcgi_index  index.php;
    #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
    #    include        fastcgi_params;
    #}

    # deny access to .htaccess files, if Apache&apos;s document root
    # concurs with nginx&apos;s one
    #
    #location ~ /\.ht {
    #    deny  all;
    #}
}


# another virtual host using mix of IP-, name-, and port-based configuration
#
#server {
#    listen       8000;
#    listen       somename:8080;
#    server_name  somename  alias  another.alias;

#    location / {
#        root   html;
#        index  index.html index.htm;
#    }
#}


# HTTPS server
#
#server {
#    listen       443 ssl;
#    server_name  localhost;

#    ssl_certificate      cert.pem;
#    ssl_certificate_key  cert.key;

#    ssl_session_cache    shared:SSL:1m;
#    ssl_session_timeout  5m;

#    ssl_ciphers  HIGH:!aNULL:!MD5;
#    ssl_prefer_server_ciphers  on;

#    location / {
#        root   html;
#        index  index.html index.htm;
#    }
#}
</code></pre><p>}</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">修改之后，重新启动Keepalive+Nginx2台主备节点。</span><br></pre></td></tr></table></figure><p></p>
<p>[root@nginx1 conf]#  /usr/local/nginx/sbin/nginx -s reload  </p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">我们现在就用虚拟IP192.168.43.150来访问我们刚才上传的图片，只是注意在地址栏中要记得输入fastdfs（这是我们nginx.conf文件中location /fastdfs&#123;&#125;规则规定的）。如下图所示，发现，我们通过虚拟IP便可以访问我们上传的图片了。这样的好处是，对用户来说，只需要访问这个虚拟IP就可以了，不用关心FastDFS集群内部的转发机制。</span><br><span class="line">![集群VIP访问截图.png](http://upload-images.jianshu.io/upload_images/1784853-1e5312e9fa770c87.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)</span><br><span class="line">至此，分布式文件系统就搭建完成了，在通过Java访问时，只要在配置文件配置所有的Tracker节点IP信息就可以啦！</span><br><span class="line">### 补充说明：</span><br><span class="line">如果Tracker 服务、Storage服务、Nginx服务开机后没有自启动，请执行一下操作并进行重启</span><br></pre></td></tr></table></figure><p></p>
<p>[root@localhost ~]# chkconfig  –add fdfs_trackerd<br>[root@localhost ~]# chkconfig  –add fdfs_storaged</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">编辑目录下的/etc/rc.d/rc.local,内容如下：</span><br></pre></td></tr></table></figure><p></p>
<p>#!/bin/bash</p>
<h1 id="THIS-FILE-IS-ADDED-FOR-COMPATIBILITY-PURPOSES"><a href="#THIS-FILE-IS-ADDED-FOR-COMPATIBILITY-PURPOSES" class="headerlink" title="THIS FILE IS ADDED FOR COMPATIBILITY PURPOSES"></a>THIS FILE IS ADDED FOR COMPATIBILITY PURPOSES</h1><p>#</p>
<h1 id="It-is-highly-advisable-to-create-own-systemd-services-or-udev-rules"><a href="#It-is-highly-advisable-to-create-own-systemd-services-or-udev-rules" class="headerlink" title="It is highly advisable to create own systemd services or udev rules"></a>It is highly advisable to create own systemd services or udev rules</h1><h1 id="to-run-scripts-during-boot-instead-of-using-this-file"><a href="#to-run-scripts-during-boot-instead-of-using-this-file" class="headerlink" title="to run scripts during boot instead of using this file."></a>to run scripts during boot instead of using this file.</h1><p>#</p>
<h1 id="In-contrast-to-previous-versions-due-to-parallel-execution-during-boot"><a href="#In-contrast-to-previous-versions-due-to-parallel-execution-during-boot" class="headerlink" title="In contrast to previous versions due to parallel execution during boot"></a>In contrast to previous versions due to parallel execution during boot</h1><h1 id="this-script-will-NOT-be-run-after-all-other-services"><a href="#this-script-will-NOT-be-run-after-all-other-services" class="headerlink" title="this script will NOT be run after all other services."></a>this script will NOT be run after all other services.</h1><p>#</p>
<h1 id="Please-note-that-you-must-run-‘chmod-x-etc-rc-d-rc-local’-to-ensure"><a href="#Please-note-that-you-must-run-‘chmod-x-etc-rc-d-rc-local’-to-ensure" class="headerlink" title="Please note that you must run ‘chmod +x /etc/rc.d/rc.local’ to ensure"></a>Please note that you must run ‘chmod +x /etc/rc.d/rc.local’ to ensure</h1><h1 id="that-this-script-will-be-executed-during-boot"><a href="#that-this-script-will-be-executed-during-boot" class="headerlink" title="that this script will be executed during boot."></a>that this script will be executed during boot.</h1><p>touch /var/lock/subsys/local<br>/usr/local/nginx/sbin/nginx</p>
<p></p><p class="code-caption" data-lang="" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">主要增加了Nginx的启动，之后进行文件生效，重新启动系统</span><br></pre></td></tr></table></figure><p></p>
<p>[root@localhost ~]# chmod  +x /etc/rc.d/rc.local<br>[root@localhost ~]# source /etc/rc.d/rc.local<br>[root@localhost ~]# reboot<br>```</p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2018-02-01T05:56:27.000Z" itemprop="dateUpdated">2018-02-01 13:56:27</time>
</span><br>


        
        这里可以写作者留言，标签和 hexo 中所有变量及辅助函数等均可调用，示例：<a href="/blogs/2018/02/01/CentOS_7.2搭建FastDFS_分布式文件系统，实现高可用集群/" target="_blank" rel="external">https://yongliangzhang.github.io/blogs/2018/02/01/CentOS_7.2搭建FastDFS_分布式文件系统，实现高可用集群/</a>
        
    </div>
    
    <footer>
        <a href="https://yongliangzhang.github.io/blogs">
            <img src="https://s1.ax2x.com/2018/01/31/ZL8UG.png" alt="YoungLiang">
            YoungLiang
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            

            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://yongliangzhang.github.io/blogs/2018/02/01/CentOS_7.2搭建FastDFS_分布式文件系统，实现高可用集群/&title=《CentOS 7.2搭建FastDFS 分布式文件系统，实现高可用集群》 — YoungLiang&pic=https://s1.ax2x.com/2018/01/31/ZL8UG.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://yongliangzhang.github.io/blogs/2018/02/01/CentOS_7.2搭建FastDFS_分布式文件系统，实现高可用集群/&title=《CentOS 7.2搭建FastDFS 分布式文件系统，实现高可用集群》 — YoungLiang&source=用心生活！创造非凡人生" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://yongliangzhang.github.io/blogs/2018/02/01/CentOS_7.2搭建FastDFS_分布式文件系统，实现高可用集群/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《CentOS 7.2搭建FastDFS 分布式文件系统，实现高可用集群》 — YoungLiang&url=https://yongliangzhang.github.io/blogs/2018/02/01/CentOS_7.2搭建FastDFS_分布式文件系统，实现高可用集群/&via=https://yongliangzhang.github.io/blogs" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://yongliangzhang.github.io/blogs/2018/02/01/CentOS_7.2搭建FastDFS_分布式文件系统，实现高可用集群/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/blogs/2018/02/01/CentOS_单机搭建FastDFS文件系统/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">CentOS 单机搭建FastDFS文件系统</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/blogs/2018/02/01/Hive高级查询操作/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Hive高级操作</h4>
      </a>
    </div>
  
</nav>



    














</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="https://s1.ax2x.com/2018/02/01/Zxkyd.png" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="https://s1.ax2x.com/2018/02/01/Zxkyd.png" data-alipay="https://s1.ax2x.com/2018/02/01/ZxllR.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/blogs/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>This blog is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>YoungLiang &copy; 2015 - 2018</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://yongliangzhang.github.io/blogs/2018/02/01/CentOS_7.2搭建FastDFS_分布式文件系统，实现高可用集群/&title=《CentOS 7.2搭建FastDFS 分布式文件系统，实现高可用集群》 — YoungLiang&pic=https://s1.ax2x.com/2018/01/31/ZL8UG.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://yongliangzhang.github.io/blogs/2018/02/01/CentOS_7.2搭建FastDFS_分布式文件系统，实现高可用集群/&title=《CentOS 7.2搭建FastDFS 分布式文件系统，实现高可用集群》 — YoungLiang&source=用心生活！创造非凡人生" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://yongliangzhang.github.io/blogs/2018/02/01/CentOS_7.2搭建FastDFS_分布式文件系统，实现高可用集群/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《CentOS 7.2搭建FastDFS 分布式文件系统，实现高可用集群》 — YoungLiang&url=https://yongliangzhang.github.io/blogs/2018/02/01/CentOS_7.2搭建FastDFS_分布式文件系统，实现高可用集群/&via=https://yongliangzhang.github.io/blogs" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://yongliangzhang.github.io/blogs/2018/02/01/CentOS_7.2搭建FastDFS_分布式文件系统，实现高可用集群/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQ4AAAEOCAAAAABd2qZ5AAAD9ElEQVR42u3aS27jUAwEwNz/0pnNLAJMJHWTzx4vSisjliWqHIDm5+srPr5/HMm7939J3m3ve/XZr1ccOHDgwIEjftQ8rPb8f0NMwk1iu7pyEu0vMeDAgQMHjkMcV6Hc3ywJ4uou+fn3BG0kD8+OAwcOHDj+E8f9FWbJu/3sPqnjwIEDB47P4dgUb0nZtnokHDhw4MDxARztCGczIkoKsPy+s7HWgV4pDhw4cOC4i/ZA8vvk1y/Z78CBAwcOHOW6QLJAkC8WbIZGSSrdPNff6+DAgQMHjjXHfmWtTc9ti7AdO7WJFgcOHDhwvIcjWTvLhzpnVxb2ifwBCwcOHDhwLDgSiFma3Bd17deWJNeHNiIOHDhw4Fhz7Au2dvVhtnCQR9IWbNHXjAMHDhw4Yo5Zsy9PUat1tEWrMY/ql7YgDhw4cOBYcMzKmzxlti3CdmFitmBRlG04cODAgaPkaNtzbeMvGSa1g6W8RZgPxnDgwIEDxymOTRnWDof2xV4+Emtf48CBAweOUxyzi86GVbMFu7NAD+kfBw4cOHAc5WgXGg7cftHR3Cw6PEzhcODAgQPHgiMJblYmzc7McTfrDg/n4MCBAweOQ/23djUhDysZSrUjollxWCRpHDhw4MCx5mibgHmynC1JbArC/MCBAwcOHGc5kvZfklbbxbjN9fPis24d4sCBAweONUeSLGfLB/uSbDYGy5uS0f8IDhw4cOAYceRNtKSoO5sI8zLyFfHjwIEDB45Z/PuAZuG2zcfND4J6vwMHDhw4cBzi2KwdtKXR2eSdL0/gwIEDB47XcbTJsr3lfllh9oNg2I7EgQMHDhxrjrwtmKSrfOSz71/mbce8gYgDBw4cOPYcmyItqQ5zlKLiHCXs6CvBgQMHDhyHOGbDnjysfNVgVjTOUu/lKgMOHDhw4DjKcf+x9t3NQOjU67oJiAMHDhw4DnG0y2rtkGkG3SbgfPXhcrMDBw4cOHAc5UjWBdq5Vp7qZssQeUn5MH/DgQMHDhxrjllpN2spzpLljKn9OleVLg4cOHDg+PF6/6htAbb/ezseq3934MCBAweONccrElgSYrviMBwmxdfBgQMHDhx7jnZs0xK0QScV56a9GIHiwIEDB44Fx3d5vK4kOzVMSq5/GRsOHDhw4FhznCrM2kCT9Dkbbs1SdY2CAwcOHDhuOdrkmi+itUOjtjWZcNSJFgcOHDhwHOJoE2Get/ctwsMF2P1nceDAgQPH2zmScisvtNpknyxDrAZgOHDgwIHj7Rx5mTRLsfcEbeFXn4MDBw4cOA5xzJJcu3CQPOqs9Mpje3gXBw4cOHCsOWbJb1O8bbYtZiVim4xx4MCBA8eI4w/ec+xvZQem8QAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/blogs/', SHARE: true, REWARD: true };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '就这样走啦？';
            clearTimeout(titleTime);
        } else {
            document.title = '欢迎访问YoungLiang小站';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
