<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    <title>Spark计算引擎 | YoungLiang | 生活充满乐趣与童真</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Spark,Spark Shell">
    <meta name="description" content="一、Spark简介 由加州大学伯克利分校的AMP实验室开源 大规模分布式通用计算引擎 具有高吞吐、低延时、通用易扩展、高容错等特点 使用Scala语言开发，提供了丰富的开发API，支持Scala、Java、 Python、R开发语言 Spark提供多种运行模式[">
<meta name="keywords" content="Spark,Spark Shell">
<meta property="og:type" content="article">
<meta property="og:title" content="Spark计算引擎">
<meta property="og:url" content="https://yongliangzhang.github.io/blogs/2018/03/05/Spark计算引擎/index.html">
<meta property="og:site_name" content="YoungLiang">
<meta property="og:description" content="一、Spark简介 由加州大学伯克利分校的AMP实验室开源 大规模分布式通用计算引擎 具有高吞吐、低延时、通用易扩展、高容错等特点 使用Scala语言开发，提供了丰富的开发API，支持Scala、Java、 Python、R开发语言 Spark提供多种运行模式[">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://simimg.com/i/rpgEO">
<meta property="og:image" content="https://simimg.com/i/rpqVe">
<meta property="og:image" content="https://simimg.com/i/rs9Fr">
<meta property="og:image" content="https://simimg.com/i/rsBAi">
<meta property="og:image" content="https://simimg.com/i/rsFwy">
<meta property="og:image" content="https://simimg.com/i/rsXEl">
<meta property="og:image" content="https://simimg.com/i/rsYy6">
<meta property="og:image" content="https://simimg.com/i/rsWH3">
<meta property="og:image" content="https://simimg.com/i/rs08p">
<meta property="og:image" content="https://simimg.com/i/rsp72">
<meta property="og:image" content="https://simimg.com/i/rsOGE">
<meta property="og:image" content="https://simimg.com/i/rsuYa">
<meta property="og:image" content="https://simimg.com/i/rsJ8S">
<meta property="og:image" content="https://simimg.com/i/rshHh">
<meta property="og:image" content="https://simimg.com/i/rsv4H">
<meta property="og:image" content="https://simimg.com/i/rusOi">
<meta property="og:image" content="https://simimg.com/i/ru4nX">
<meta property="og:image" content="https://simimg.com/i/ruhcJ">
<meta property="og:image" content="https://simimg.com/i/ruPX6">
<meta property="og:image" content="https://simimg.com/i/rucN3">
<meta property="og:updated_time" content="2018-03-06T00:37:27.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Spark计算引擎">
<meta name="twitter:description" content="一、Spark简介 由加州大学伯克利分校的AMP实验室开源 大规模分布式通用计算引擎 具有高吞吐、低延时、通用易扩展、高容错等特点 使用Scala语言开发，提供了丰富的开发API，支持Scala、Java、 Python、R开发语言 Spark提供多种运行模式[">
<meta name="twitter:image" content="https://simimg.com/i/rpgEO">
    
        <link rel="alternate" type="application/atom+xml" title="YoungLiang" href="/blogs/atom.xml">
    
    <link rel="shortcut icon" href="/blogs/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/blogs/img/brand.jpg)">
      <div class="brand">
        <a href="/blogs/" class="avatar waves-effect waves-circle waves-light">
          <img src="https://s1.ax2x.com/2018/01/31/ZL8UG.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">YoungLiang</h5>
          <a href="mailto:zhangyongliang1231@163.com" title="zhangyongliang1231@163.com" class="mail">zhangyongliang1231@163.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/blogs/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/blogs/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                历程
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/blogs/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/blogs/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/yongliangZhang" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://www.jianshu.com/u/31c3a36c409d" target="_blank" >
                <i class="icon icon-lg icon-book"></i>
                简书
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Spark计算引擎</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Spark计算引擎</h1>
        <h5 class="subtitle">
            
                <time datetime="2018-03-05T11:45:00.000Z" itemprop="datePublished" class="page-time">
  2018-03-05
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#一、Spark简介"><span class="post-toc-number">1.</span> <span class="post-toc-text">一、Spark简介</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#二、Spark特点"><span class="post-toc-number">2.</span> <span class="post-toc-text">二、Spark特点</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#三、Spark核心概念-RDD"><span class="post-toc-number">3.</span> <span class="post-toc-text">三、Spark核心概念-RDD</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-RDD操作"><span class="post-toc-number">3.0.1.</span> <span class="post-toc-text">1.RDD操作</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-RDD操作示例"><span class="post-toc-number">3.0.2.</span> <span class="post-toc-text">2.RDD操作示例</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-Transformation与Action对比"><span class="post-toc-number">3.0.3.</span> <span class="post-toc-text">3.Transformation与Action对比</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#4-Transformation-Lazy-Execution"><span class="post-toc-number">3.0.4.</span> <span class="post-toc-text">4.Transformation Lazy Execution</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#5-程序执行流程"><span class="post-toc-number">3.0.5.</span> <span class="post-toc-text">5.程序执行流程</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#6-RDD-Dependency依赖"><span class="post-toc-number">3.0.6.</span> <span class="post-toc-text">6.RDD Dependency依赖</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#7-RDD-Cache缓存"><span class="post-toc-number">3.0.7.</span> <span class="post-toc-text">7.RDD Cache缓存</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#四、Spark程序架构"><span class="post-toc-number">4.</span> <span class="post-toc-text">四、Spark程序架构</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#五、Spark运行模式"><span class="post-toc-number">5.</span> <span class="post-toc-text">五、Spark运行模式</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-Spark-Local模式"><span class="post-toc-number">5.0.1.</span> <span class="post-toc-text">1.Spark Local模式</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-Spark-Standalone模式"><span class="post-toc-number">5.0.2.</span> <span class="post-toc-text">2.Spark Standalone模式</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-YARN程序运行流程"><span class="post-toc-number">5.0.3.</span> <span class="post-toc-text">3.YARN程序运行流程</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#4-Spark-YARN模式"><span class="post-toc-number">5.0.4.</span> <span class="post-toc-text">4.Spark YARN模式</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#5-Spark内部执行流程"><span class="post-toc-number">5.0.5.</span> <span class="post-toc-text">5.Spark内部执行流程</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#六、Spark调度模块"><span class="post-toc-number">6.</span> <span class="post-toc-text">六、Spark调度模块</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-Spark任务类型和Job划分"><span class="post-toc-number">6.0.1.</span> <span class="post-toc-text">1.Spark任务类型和Job划分</span></a></li></ol></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-Spark计算引擎"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Spark计算引擎</h1>
        <div class="post-meta">
            <time class="post-time" title="2018-03-05 19:45:00" datetime="2018-03-05T11:45:00.000Z"  itemprop="datePublished">2018-03-05</time>

            


            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h2 id="一、Spark简介"><a href="#一、Spark简介" class="headerlink" title="一、Spark简介"></a>一、Spark简介</h2><ul>
<li>由加州大学伯克利分校的AMP实验室开源</li>
<li>大规模分布式通用计算引擎</li>
<li>具有高吞吐、低延时、通用易扩展、高容错等特点</li>
<li>使用Scala语言开发，提供了丰富的开发API，支持Scala、Java、</li>
<li>Python、R开发语言</li>
<li>Spark提供多种运行模式<br>[<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://simimg.com/i/rpgEO" alt="Spark架构](https://s1.ax2x.com/2018/03/05/rpgEO.png)" title="">
                </div>
                <div class="image-caption">Spark架构](https://s1.ax2x.com/2018/03/05/rpgEO.png)</div>
            </figure><a id="more"></a>
<h2 id="二、Spark特点"><a href="#二、Spark特点" class="headerlink" title="二、Spark特点"></a>二、Spark特点</h2></li>
<li>计算高效<ul>
<li>使用内存计算引擎，提供Cache缓存机制支持迭代计算或多次数据共享，减少数据读取的IO开销</li>
<li>DAG引擎，减少多次计算之间中间结果写到HDFS的开销</li>
<li>使用多线程池模型来减少task启动开销，shuffle过程中避免不必要的</li>
<li>sort操作以及减少磁盘IO操作</li>
</ul>
</li>
<li>通用易用<ul>
<li>提供了丰富的开发API，支持Scala、Java、Python、R开发语言</li>
<li>集成批处理、流处理、交互式计算、机器学习算法、图计算</li>
</ul>
</li>
<li>运行模式多样<ul>
<li>Local、Standalone、Yarn、Mesos<br>[<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://simimg.com/i/rpqVe" alt="运行比对图](https://s1.ax2x.com/2018/03/05/rpqVe.png)" title="">
                </div>
                <div class="image-caption">运行比对图](https://s1.ax2x.com/2018/03/05/rpqVe.png)</div>
            </figure><h2 id="三、Spark核心概念-RDD"><a href="#三、Spark核心概念-RDD" class="headerlink" title="三、Spark核心概念-RDD"></a>三、Spark核心概念-RDD</h2></li>
</ul>
</li>
<li>RDD：Resilient Distributed Datasets弹性分布式数据集<ul>
<li>Spark基于RDD进行计算</li>
<li>分布在集群中的只读对象集合（由多个Partition构成）</li>
<li>可以存储在磁盘或内存中</li>
<li>可以通过并行转换操作构造</li>
<li>失效后自动重构<br>[<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://simimg.com/i/rs9Fr" alt="RDD](https://s1.ax2x.com/2018/03/05/rs9Fr.png)" title="">
                </div>
                <div class="image-caption">RDD](https://s1.ax2x.com/2018/03/05/rs9Fr.png)</div>
            </figure><h4 id="1-RDD操作"><a href="#1-RDD操作" class="headerlink" title="1.RDD操作"></a>1.RDD操作</h4></li>
</ul>
</li>
<li>Transformation<ul>
<li>将Scala集合或者Hadoop数据集构造一个新的RDD</li>
<li>通过已有的RDD产生新的RDD</li>
<li>只记录转换关系，不触发计算</li>
<li>如：map、filter等<br>-Action</li>
<li>通过RDD计算得到一个或者一组值</li>
<li>真正触发执行</li>
<li>如：count、collect、saveAsTextFile</li>
</ul>
</li>
</ul>
<p>[<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://simimg.com/i/rsBAi" alt="RDD操作](https://s1.ax2x.com/2018/03/05/rsBAi.png)" title="">
                </div>
                <div class="image-caption">RDD操作](https://s1.ax2x.com/2018/03/05/rsBAi.png)</div>
            </figure></p>
<h4 id="2-RDD操作示例"><a href="#2-RDD操作示例" class="headerlink" title="2.RDD操作示例"></a>2.RDD操作示例</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rdd1.map(_+1).saveAsTextFile(&quot;hdfs://node01:9000/&quot;)</span><br></pre></td></tr></table></figure>
<p>[<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://simimg.com/i/rsFwy" alt="RDD输出](https://s1.ax2x.com/2018/03/05/rsFwy.png)" title="">
                </div>
                <div class="image-caption">RDD输出](https://s1.ax2x.com/2018/03/05/rsFwy.png)</div>
            </figure></p>
<h4 id="3-Transformation与Action对比"><a href="#3-Transformation与Action对比" class="headerlink" title="3.Transformation与Action对比"></a>3.Transformation与Action对比</h4><ul>
<li>接口定义方式不同<ul>
<li>Transformation：RDD[X] -&gt; RDD[Y]</li>
<li>Action：RDD[X] -&gt; Z</li>
</ul>
</li>
<li>执行计算方式不同<ul>
<li>Transformation采用惰性执行方式，只记录RDD转化关系，不会触发真正计算执行</li>
<li>Action真正触发计算执行<h4 id="4-Transformation-Lazy-Execution"><a href="#4-Transformation-Lazy-Execution" class="headerlink" title="4.Transformation Lazy Execution"></a>4.Transformation Lazy Execution</h4></li>
</ul>
</li>
<li>惰性执行</li>
</ul>
<p>[<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://simimg.com/i/rsXEl" alt="懒惰执行](https://s1.ax2x.com/2018/03/05/rsXEl.png)" title="">
                </div>
                <div class="image-caption">懒惰执行](https://s1.ax2x.com/2018/03/05/rsXEl.png)</div>
            </figure></p>
<h4 id="5-程序执行流程"><a href="#5-程序执行流程" class="headerlink" title="5.程序执行流程"></a>5.程序执行流程</h4><ul>
<li>Spark中的WordCount</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">val rdd1 = sc.textFile(&quot;hdfs://192.168.183.101:9000/data/wc/in&quot;)</span><br><span class="line">val rdd2 = rdd1.flatMap(_.split(&quot;\t&quot;))</span><br><span class="line">val rdd3= rdd2.map((_,1))</span><br><span class="line">val rdd4 = rdd3.reduceByKey(_ + _)</span><br><span class="line">rdd4.saveAsTextFile(“hdfs://192.168.183.100:9000/data/wc/out”)</span><br></pre></td></tr></table></figure>
<p>[<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://simimg.com/i/rsYy6" alt="Spark程序执行流程](https://s1.ax2x.com/2018/03/05/rsYy6.png)" title="">
                </div>
                <div class="image-caption">Spark程序执行流程](https://s1.ax2x.com/2018/03/05/rsYy6.png)</div>
            </figure></p>
<h4 id="6-RDD-Dependency依赖"><a href="#6-RDD-Dependency依赖" class="headerlink" title="6.RDD Dependency依赖"></a>6.RDD Dependency依赖</h4><ul>
<li>Narrow Dependency窄依赖<ul>
<li>父RDD中的分区最多只能被一个子RDD的一个分区使用</li>
<li>子RDD如果只有部分分区数据丢失 或者损坏只需要从对应的父RDD重新计算恢复</li>
</ul>
</li>
<li>Shuffle Dependency宽依赖<ul>
<li>子RDD分区依赖父RDD所有分区</li>
<li>子RDD如果部分分区或者全部分区 数据丢失或者损坏需要从所有父RDD重新计算，相对窄依赖付出的<br>代价更高，尽量避免宽依赖的使用</li>
</ul>
</li>
</ul>
<p>[<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://simimg.com/i/rsWH3" alt="窄依赖](https://s1.ax2x.com/2018/03/05/rsWH3.png)" title="">
                </div>
                <div class="image-caption">窄依赖](https://s1.ax2x.com/2018/03/05/rsWH3.png)</div>
            </figure><br>[<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://simimg.com/i/rs08p" alt="宽依赖](https://s1.ax2x.com/2018/03/05/rs08p.png)" title="">
                </div>
                <div class="image-caption">宽依赖](https://s1.ax2x.com/2018/03/05/rs08p.png)</div>
            </figure></p>
<h4 id="7-RDD-Cache缓存"><a href="#7-RDD-Cache缓存" class="headerlink" title="7.RDD Cache缓存"></a>7.RDD Cache缓存</h4><ul>
<li>Spark允许将RDD缓存到内存或磁盘上，方便重用，提高性能</li>
<li>Spark提供了多种缓存级别</li>
<li>用户可以根据实际需求进行调整</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">val rdd = sc.textFile(inputArg)</span><br><span class="line">rdd.cache()//实际上是调用了rdd.persist(StorageLevel.MEMORY_ONLY)</span><br><span class="line">//data.persist(StorageLevel.MEMORY_AND_DISK)</span><br></pre></td></tr></table></figure>
<p>[<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://simimg.com/i/rsp72" alt="RDD缓存](https://s1.ax2x.com/2018/03/05/rsp72.png)" title="">
                </div>
                <div class="image-caption">RDD缓存](https://s1.ax2x.com/2018/03/05/rsp72.png)</div>
            </figure></p>
<h2 id="四、Spark程序架构"><a href="#四、Spark程序架构" class="headerlink" title="四、Spark程序架构"></a>四、Spark程序架构</h2><ul>
<li>Driver：一个Spark程序有一个Driver，一个Driver创建一个Spark Context，程序的main<br>函数运行在Driver中。Driver主要负责Spark程序的解析、划分Stage，调度Task到Executor上执行</li>
<li>SparkContext：加载配置信息，初始化Spark程序运行环境，创建内部的DAGScheduler和TaskScheduler</li>
<li>Executor：负责执行Driver分发的Task任务，集群中一个节点可以启动多个Executor，每个一个Executor通过多线程运行多个Task任务</li>
<li>Task：Spark运行的基本单位，一个Task负责处理RDD一个分区的计算逻辑<br>[<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://simimg.com/i/rsOGE" alt="Spark程序架构](https://s1.ax2x.com/2018/03/05/rsOGE.png)" title="">
                </div>
                <div class="image-caption">Spark程序架构](https://s1.ax2x.com/2018/03/05/rsOGE.png)</div>
            </figure><h2 id="五、Spark运行模式"><a href="#五、Spark运行模式" class="headerlink" title="五、Spark运行模式"></a>五、Spark运行模式</h2></li>
<li>Local本地模式<ul>
<li>单机运行，通常用于测试</li>
</ul>
</li>
<li>Standalone独立模式<ul>
<li>Spark集群单独运行</li>
</ul>
</li>
<li>Yarn/Mesos<ul>
<li>运行在其他资源管理系统上，如Yarn、Mesos<h4 id="1-Spark-Local模式"><a href="#1-Spark-Local模式" class="headerlink" title="1.Spark Local模式"></a>1.Spark Local模式</h4></li>
</ul>
</li>
<li>Local本地模式<ul>
<li>将Spark应用以多线程方式，直接运行在本地，方便调试</li>
</ul>
</li>
<li>本地模式分类<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">local：只启动一个线程运行executor</span><br><span class="line">local[n]：启动n个线程运行executor</span><br><span class="line">local[*]：启动跟cpu数目相同的executor</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-Spark-Standalone模式"><a href="#2-Spark-Standalone模式" class="headerlink" title="2.Spark Standalone模式"></a>2.Spark Standalone模式</h4><ul>
<li>集群独立部署<br>[<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://simimg.com/i/rsuYa" alt="Spark standalone模式](https://s1.ax2x.com/2018/03/05/rsuYa.png)" title="">
                </div>
                <div class="image-caption">Spark standalone模式](https://s1.ax2x.com/2018/03/05/rsuYa.png)</div>
            </figure><h4 id="3-YARN程序运行流程"><a href="#3-YARN程序运行流程" class="headerlink" title="3.YARN程序运行流程"></a>3.YARN程序运行流程</h4>[<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://simimg.com/i/rsJ8S" alt="Yarn执行流程](https://s1.ax2x.com/2018/03/05/rsJ8S.png)" title="">
                </div>
                <div class="image-caption">Yarn执行流程](https://s1.ax2x.com/2018/03/05/rsJ8S.png)</div>
            </figure><h4 id="4-Spark-YARN模式"><a href="#4-Spark-YARN模式" class="headerlink" title="4.Spark YARN模式"></a>4.Spark YARN模式</h4></li>
<li>yarn-cluster</li>
</ul>
<p>[<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://simimg.com/i/rshHh" alt="Spark on yarn](https://s1.ax2x.com/2018/03/05/rshHh.png)" title="">
                </div>
                <div class="image-caption">Spark on yarn](https://s1.ax2x.com/2018/03/05/rshHh.png)</div>
            </figure></p>
<h4 id="5-Spark内部执行流程"><a href="#5-Spark内部执行流程" class="headerlink" title="5.Spark内部执行流程"></a>5.Spark内部执行流程</h4><p>[<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://simimg.com/i/rsv4H" alt="Spark 内部执行流程](https://s1.ax2x.com/2018/03/05/rsv4H.png)" title="">
                </div>
                <div class="image-caption">Spark 内部执行流程](https://s1.ax2x.com/2018/03/05/rsv4H.png)</div>
            </figure></p>
<ul>
<li>生成逻辑查询计划<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sc.textFile(inputArg)</span><br><span class="line">.flatMap(_.split(&quot;\t&quot;))</span><br><span class="line">.map((_,1))</span><br><span class="line">.reduceByKey(_ + _)</span><br><span class="line">.saveAsTextFile(outArg)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>[<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://simimg.com/i/rusOi" alt="逻辑查询计划](https://s1.ax2x.com/2018/03/05/rusOi.png)" title="">
                </div>
                <div class="image-caption">逻辑查询计划](https://s1.ax2x.com/2018/03/05/rusOi.png)</div>
            </figure></p>
<ul>
<li>生成物理查询计划<br>[<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://simimg.com/i/ru4nX" alt="物理查询计划](https://s1.ax2x.com/2018/03/05/ru4nX.png)" title="">
                </div>
                <div class="image-caption">物理查询计划](https://s1.ax2x.com/2018/03/05/ru4nX.png)</div>
            </figure></li>
<li>任务调度与执行<br>[<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://simimg.com/i/ruhcJ" alt="任务调度与执行](https://s1.ax2x.com/2018/03/05/ruhcJ.png)" title="">
                </div>
                <div class="image-caption">任务调度与执行](https://s1.ax2x.com/2018/03/05/ruhcJ.png)</div>
            </figure><h2 id="六、Spark调度模块"><a href="#六、Spark调度模块" class="headerlink" title="六、Spark调度模块"></a>六、Spark调度模块</h2></li>
<li>DAG：Directed Acyclic Graph有向无环图</li>
<li>DAGScheduler<ul>
<li>根据计算任务的依赖关系建立DAG</li>
<li>根据依赖关系是否是宽依赖，将DAG划分为不同的Stage阶段</li>
<li>将各个Stage中的Task组成的TaskSet提交到TaskScheduler</li>
</ul>
</li>
<li>TaskScheduler<ul>
<li>负责Application的Job调度</li>
<li>重新提交执行失败的Task</li>
<li>为执行速度慢的Task启动备份任务<br>[<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://simimg.com/i/ruPX6" alt="Sparkr 模块调度](https://s1.ax2x.com/2018/03/05/ruPX6.png)" title="">
                </div>
                <div class="image-caption">Sparkr 模块调度](https://s1.ax2x.com/2018/03/05/ruPX6.png)</div>
            </figure><h4 id="1-Spark任务类型和Job划分"><a href="#1-Spark任务类型和Job划分" class="headerlink" title="1.Spark任务类型和Job划分"></a>1.Spark任务类型和Job划分</h4></li>
</ul>
</li>
<li>Spark中task类型<ul>
<li>ShuffleMapTask：除了最后一个输出Task，其他Task类型都是 ShuffleMapTask</li>
<li>ResultTask：只有最后一个阶段输出的Task是ResultTask</li>
</ul>
</li>
<li>Appication中调用一次Action就会生成一个Job<br>[<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://simimg.com/i/rucN3" alt="Spark 任务划分](https://s1.ax2x.com/2018/03/05/rucN3.png)" title="">
                </div>
                <div class="image-caption">Spark 任务划分](https://s1.ax2x.com/2018/03/05/rucN3.png)</div>
            </figure></li>
</ul>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2018-03-06T00:37:27.000Z" itemprop="dateUpdated">2018-03-06 08:37:27</time>
</span><br>


        
    </div>
    
    <footer>
        <a href="https://yongliangzhang.github.io/blogs">
            <img src="https://s1.ax2x.com/2018/01/31/ZL8UG.png" alt="YoungLiang">
            YoungLiang
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blogs/tags/Spark/">Spark</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blogs/tags/Spark-Shell/">Spark Shell</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://yongliangzhang.github.io/blogs/2018/03/05/Spark计算引擎/&title=《Spark计算引擎》 — YoungLiang&pic=https://s1.ax2x.com/2018/01/31/ZL8UG.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://yongliangzhang.github.io/blogs/2018/03/05/Spark计算引擎/&title=《Spark计算引擎》 — YoungLiang&source=一、Spark简介
由加州大学伯克利分校的AMP实验室开源
大规模分布式通用计算引擎
具有高吞吐、低延时、通用易扩展、高容错等特点
使用Scala语言开发..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://yongliangzhang.github.io/blogs/2018/03/05/Spark计算引擎/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Spark计算引擎》 — YoungLiang&url=https://yongliangzhang.github.io/blogs/2018/03/05/Spark计算引擎/&via=https://yongliangzhang.github.io/blogs" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://yongliangzhang.github.io/blogs/2018/03/05/Spark计算引擎/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between flex-row-reverse">
  

  
    <div class="waves-block waves-effect next">
      <a href="/blogs/2018/02/03/Flume构建日志采集系统/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Flume构建日志采集系统</h4>
      </a>
    </div>
  
</nav>



    













<!-- 来必力City版安装代码 -->
<div id="lv-container" data-id="city" data-uid="MTAyMC8zMzc5Ny8xMDM1MA==">
<script type="text/javascript">
   (function(d, s) {
       var j, e = d.getElementsByTagName(s)[0];

       if (typeof LivereTower === 'function') { return; }

       j = d.createElement(s);
       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
       j.async = true;

       e.parentNode.insertBefore(j, e);
   })(document, 'script');
</script>
<noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
</div>
<!-- City版安装代码已完成 -->


</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="https://s1.ax2x.com/2018/02/01/Zxkyd.png" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="https://s1.ax2x.com/2018/02/01/Zxkyd.png" data-alipay="https://s1.ax2x.com/2018/02/01/ZxllR.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/blogs/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>This blog is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>YoungLiang &copy; 2018</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://yongliangzhang.github.io/blogs/2018/03/05/Spark计算引擎/&title=《Spark计算引擎》 — YoungLiang&pic=https://s1.ax2x.com/2018/01/31/ZL8UG.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://yongliangzhang.github.io/blogs/2018/03/05/Spark计算引擎/&title=《Spark计算引擎》 — YoungLiang&source=一、Spark简介
由加州大学伯克利分校的AMP实验室开源
大规模分布式通用计算引擎
具有高吞吐、低延时、通用易扩展、高容错等特点
使用Scala语言开发..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://yongliangzhang.github.io/blogs/2018/03/05/Spark计算引擎/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Spark计算引擎》 — YoungLiang&url=https://yongliangzhang.github.io/blogs/2018/03/05/Spark计算引擎/&via=https://yongliangzhang.github.io/blogs" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://yongliangzhang.github.io/blogs/2018/03/05/Spark计算引擎/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACs0lEQVR42u3awY7iQAwEUP7/p2evKy2Jquw0w0ovJzSgpB8jtU25X6/4+vnryv/y79+vrvyJrxMXHh4e3mLpVw+efebqWfeMq8+368HDw8M7zctvnSwuWVayh7dFAg8PD+87ee3r+61809Dj4eHh/Y+8ZFn5u0nLjoeHh/c9vPzW7VKSzT0pFcezFjw8PLxu3lRs8d/w+sh8Dw8PD289Vc9b2yTM3bTgP6MLDw8P7wQvX8TmAbNmum24Lz+Jh4eH9ygv2eLvHz87YpWEFG2Y++Y1Hh4e3mFePVgaFZX2bnlQG0328PDw8Na8NgJoo4R2rNUeEYjabjw8PLxHeTkgb2TzI1wzRl0S8PDw8B7l5XFD3iInTXB7VCuPLd7cBw8PD+8Ybx9GzL6INtRo9388PDy8Z3mzTXy2le/xbTCBh4eHd4LXDvjbBjqPgO/v1kYVeHh4eJ/krQ45LZaeD+Hq9eDh4eE9yptt6JuItj3m1Tbxr81S8PDw8MrZ+mwTTxbdbu55AahTajw8PLw1L29t2819HwfvywkeHh7eCd6+MMzi1za2aCNjPDw8vNO8NszdtMJ5eBH9Gsg/g4eHh/cQL48bcnaOSRLXTSHBw8PDO8Frt+C8PNzfczZsaw+B4eHh4Z3jta1qOwZLCsmmBcfDw8P7LV4OaBvl2fi/PZTweur/g4eHh1fyNgP+PN6drWHYmuPh4eEd450OYTdxcBLjFm/j4eHhLXiz7biNX9uoYnbI4M2XhYeHh3eANxvPz8Lc9njW/jUeHh7eOd7sZ3+79Nl4rC0bdWONh4eHt+C14WweN+S1aFbBosKAh4eH96u82ePzsjGLd4sBGB4eHt7HeUn8ujkytT9GgIeHh/cZXr5976Pb/N22UK1iXDw8PLxu1l//4J8dLMgxs4h5eOHh4eGlvD/ogUrfXq1QOwAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/blogs/', SHARE: true, REWARD: true };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '就这样走啦？';
            clearTimeout(titleTime);
        } else {
            document.title = '欢迎访问YoungLiang小站';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
